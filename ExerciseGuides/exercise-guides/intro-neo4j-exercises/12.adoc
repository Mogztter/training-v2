= Exercise 12
== Exercise 12: Using Cypher parameters (Preparations)


Make sure you have the Movie database, which contains 173 nodes and 257 relationships.

This is what you should see when you click the database icon:

image::{guides}/img/AfterExercise11.png[After exercise 11,200,200, role=left]

If your database does not have this number of nodes and relationships, you can use the script below to reset it:

[source, cypher]
----
include::scripts/AfterExercise11.cypher[]
----


== Exercise 12: Using Cypher parameters (Overview)

You have gained experience with the basics of accessing a Neo4j graph by querying it, creating nodes and relationships, and updating the graph.

In this exercise you enhance Cypher statements you write so that you can parameterize values used during the execution of your Cypher statements.

. In Part 1, you define and use a parameter.
. In Part 2, you define and use multiple parameters.

Go to the next page to perform the two parts of this exercise.

== Instructions, Exercise 12, Part 1
.*Defining and using a parameter*

Suppose that you want to create Cypher statements that enables you to easily test against a number of values in the graph.
You will be exploring the graph for people who reviewed movies and the actors in these movies.

Perform these steps:

. Write and execute a Cypher query that returns the names of people who reviewed movies and the actors in these movies by returning the name of the reviewer, the movie title reviewed, the release date of the movie, the rating given to the movie by the reviewer, and the list of actors for that particular movie.
. Add a parameter named _year_ to your session with a value of _2000_.
. Modify the Cypher query you just wrote to filter by the _year_ parameter.
. Modify the _year_ parameter to be a different value, _2006_, and retest your query.

== Solution, Exercise 12, Part 1
.*Defining and using a parameter*

Suppose that you want to create Cypher statements that enables you to easily test against a number of values in the graph.
You do not want to hard-code the value for _released_ for a _Movie_node in your query.

Perform these steps:

*1. Write and execute a Cypher query that returns the names of people who reviewed movies and the actors in these movies by returning the name of the reviewer, the movie title reviewed, the release date of the movie, the rating given to the movie by the reviewer, and the list of actors for that particular movie.*

[source, cypher]
----
MATCH (r:Person)-[rel:REVIEWED]->(m:Movie)<-[:ACTED_IN]-(a:Person)
RETURN  DISTINCT r.name, m.title, m.released, rel.rating, collect(a.name)
----

The result returned should be:

[.thumb]
image::{guides}/img/InitialQueryWithoutParms.png[InitialQueryWithoutParms,width=600]

*2. Add a parameter named _year_ to your session with a value of _2000_.*

[source, cypher]
----
:param year => 2000
----

[.thumb]
image::{guides}/img/SetYearParam.png[SetYearParam,width=400,float="right"]

The result returned should be:

++++
<div style="clear: both;"></div>
++++

*3. Modify the Cypher query you just wrote to filter by the _year_ parameter.*

[source, cypher]
----
MATCH (r:Person)-[rel:REVIEWED]->(m:Movie)<-[:ACTED_IN]-(a:Person)
WHERE m.released = $year
RETURN  DISTINCT r.name, m.title, m.released, rel.rating, collect(a.name)
----

The result returned should be:

[.thumb]
image::{guides}/img/UsingOneParameter.png[UsingOneParameter,width=600]

*4. Modify the _year_ parameter to be a different value, _2006_, and retest your query.*

[source, cypher]
----
:param year => 2006
----

The result returned  with the same query should be:

[.thumb]
image::{guides}/img/UsingOneParameter2.png[UsingOneParameter2,width=600]

Next, Part 2

== Instructions, Exercise 12, Part 2
.*Defining and using parameters*

Suppose that you want to parameterize both the values in your query for _released_ for a _Movie_node and the _rating_ value for the _REVIEWED_ relationship.

Perform these steps:

. Add a parameter named _ratingValue_ to your session with a value of _65_.
. Modify the query you wrote previously to also filter the result returned by the  _rating_ for the movie.
. Modify the _ratingValue_ parameter to be a different value, _60_, and retest your query.

== Solution, Exercise 12, Part 2
.*Defining and using parameters*

Suppose that you want to parameterize both the values in your query for _released_ for a _Movie_node and the _rating_ value for the _REVIEWED_ relationship.

Perform these steps:

*1. Add a parameter named _ratingValue_ to your session with a value of _65_.*

[source, cypher]
----
:params {year: 2006, ratingValue: 65}
----

[.thumb]
image::{guides}/img/SetTwoParameters.png[SetTwoParameters,width=400,float="right"]

The result returned should be:

++++
<div style="clear: both;"></div>
++++

*2. Modify the query you wrote previously to also filter the result returned by  the _rating_ for the movie.* 

[source, cypher]
----
MATCH (r:Person)-[rel:REVIEWED]->(m:Movie)<-[:ACTED_IN]-(a:Person)
WHERE m.released = $year AND
      rel.rating > $ratingValue
RETURN  DISTINCT r.name, m.title, m.released, rel.rating, collect(a.name)
----

For the above statement, the result returned should be:
[.thumb]
image::{guides}/img/UseTwoParameters.png[UseTwoParameters,width=600]


*3. Modify the _ratingValue_ parameter to be a different value, _60_, and retest your query.*

[source, cypher]
----
:params {year: 2006, ratingValue: 60}
----

The result returned with the new parameter value should be:
[.thumb]
image::{guides}/img/UseTwoParameters2.png[UseTwoParameters2,width=600]

== Exercise 12: Using Cypher parameters (Summary)

In this exercise you gained experience using parameters in your Neo4j Browser session and your Cypher statements.

pass:a[<a play-topic='{guides}/13.html'>Continue to Exercise 13</a>]
