= Exercise 2

== Exercise 2: Filtering queries using property values

=== Preparations

Make sure you have the Movie database, which contains 171 nodes and 253 relationships.

This is what you should see when you click the database icon:   
   
image:{guides}/img/InitialDatabase.png[InitialDatabase,200,200]

If your database does not have this number of nodes and relationships, you can use the script below to reset it:

[source,cypher]
----
include::scripts/initialDatabase.cypher[]
----


== Exercise Overview

Thus far, you have filtered what nodes are returned from a query based upon the `Label` for the node where you returned _Person_ or _Movie_ nodes.

In this exercise, you will retrieve nodes from the database by specifying a filter criteria that is a property value.
Then, you will examine the property keys in the training _Movie_ graph.
Finally, you will query the graph to return property values for nodes retrieved.

. In Part 1, you retrieve all movies that were released in a specific year.
. In Part 2, you query the database for all property keys.
. In Part 3, you retrieve all Movies released in a specific year, returning their titles.
. In Part 4, you display _title_, _released_, and _tagline_ values for every _Movie_ node in the graph.

Go to the next page to perform the four parts of this exercise.

== Instructions, Exercise 2, Part 1
.*Retrieving all movies released in a specific year*

You want to know which movies were release in the year 2003.

. In the query editor pane, enter the Cypher query to retrieve all _Movie_ nodes that have a _released_ property value of 2003.
. View the result pane as a table.

.*Taking it further (optional)*
** Retrieve all movie nodes in the database and view the data as a table.
Notice the values for the released property for each node.
** Try querying the graph using different years.

== Solution, Exercise 2, Part 1
.*Retrieving all movies released in a specific year*

You want to know which movies were release in the year 2003.

*1. In the query editor pane, enter the Cypher query to retrieve all _Movie_ nodes that have a _released_ property value of 2003.*

[source, cypher]
----
MATCH (m:Movie {released:2003}) RETURN m
----

[.thumb]
image::{guides}/img/MoviesReleased2003_Nodes.png[MoviesReleased2003_Nodes,width=300,float="right"]

The result returned should be:

++++
<div style="clear: both;"></div>
++++

*2. View the result pane as a table.
In the result pane, click the table icon.
You should see this table in the result pane:*

[.thumb]
image::{guides}/img/MoviesReleased2003_Table.png[MoviesReleased2003_Table,width=400,float="right"]

++++
<div style="clear: both;"></div>
++++

Next, Part 2

== Instructions, Exercise 2, Part 2
.*Querying the database for all property keys*

You want to know the existing property keys used in a graph.
This will help you to write Cypher queries that utilizes property keys for filtering data or for returning data.

In the query editor pane, enter the Cypher query to retrieve the property keys from the database.

== Solution, Exercise 2, Part 2
.*Querying the database for all property keys*

You want to know the existing property keys used in a graph.
This will help you to write Cypher queries that utilizes property keys for filtering data or for returning data.

*In the query editor pane, enter the Cypher query to retrieve the property keys from the database.*

[source, cypher]
----
CALL db.propertyKeys
----

[.thumb]
image::{guides}/img/call_db.PropertyKeys.png[call_db.PropertyKeys,width=400,float="right"]

The result returned should be:

++++
<div style="clear: both;"></div>
++++

Next, Part 3

== Instructions, Exercise 2, Part 3
.*Retrieving all Movies released in 2006, returning their titles*

Rather than returning the nodes that satisfy a query, you want to return data from the nodes.

In the query editor pane, enter the Cypher query to retrieve all _Movie_ nodes from the database with a _released_ value of _2006_, but rather than returning the nodes, return the _title_ values for all nodes retrieved.

.*Taking it further (optional)*
** Retrieve all _Movie_ nodes and view them as a table.
Observe the properties that _Movie_ nodes have.
** Query the database using a different year and also return more property values.

== Solution, Exercise 2, Part 3
.*Retrieving all Movies released in 2006, returning their titles*

Rather than returning the nodes that satisfy a query, you want to return data from the nodes.

*In the query editor pane, enter the Cypher query to retrieve all Movie nodes from the database with a _released_ value of _2006_, but rather than returning the nodes, return the _title_ values for all nodes retrieved.*

[source, cypher]
----
MATCH (m:Movie {released: 2006}) RETURN m.title
----

[.thumb]
image::{guides}/img/MoviesReleased2006_titles.png[MoviesReleased2006_titles,width=400,float="right"]

The result returned should be:

++++
<div style="clear: both;"></div>
++++

Next, Part 4

== Instructions, Exercise 2, Part 4
.*Retrieving all Movies to display property values*


. In the query editor pane, enter the Cypher query to retrieve all _Movie_ nodes from the database and write _title_, _released_, and _tagline_ values.
. Modify the query you just ran so that the headings for the columns of the table returned are more descriptive.

== Solution, Exercise 2, Part 4
.*Retrieving all Movies to display property values*

When you start working with a graph, it is sometimes helpful to simply view property values.
This can sometimes help to inform you about future queries you may want to execute against the graph.

*1. In the query editor pane, enter the Cypher query to retrieve all _Movie_ nodes from the database and write _title_, _released_, and _tagline_ values.*

[source, cypher]
----
MATCH (m:Movie) RETURN m.title, m.released, m.tagline
----

[.thumb]
image::{guides}/img/RetrieveTitleReleasedTagline.png[RetrieveTitleReleasedTagline,width=400,float="right"]

The result returned should be:

++++
<div style="clear: both;"></div>
++++

*2. Modify the query you just ran so that the headings for the columns of the table returned are more descriptive.*

[source, cypher]
----
MATCH (m:Movie) RETURN m.title AS `movie title`, m.released AS released, m.tagline AS tagLine
----

[.thumb]
image::{guides}/img/UsingAliases.png[UsingAliases,width=400,float="right"]

The result returned should be:

++++
<div style="clear: both;"></div>
++++

== Exercise Summary

In this exercise, you retrieved nodes from the database by specifying a filter criteria that is a property value.
Then, you examined the property keys in the training _Movie_ graph.
Finally, you queried the graph to return property values for nodes retrieved.


pass:a[<a play-topic='{guides}/03.html'>Continue to Exercise 3</a>]
