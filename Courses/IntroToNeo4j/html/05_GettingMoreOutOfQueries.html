<html>
   <head>
      <meta charset="utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1.0"></meta>
      <title>Neo4j GraphAcademy: Introduction to Neo4j</title>
      <link rel="stylesheet" type="text/css" href="https://neo4j.com/docs/developer-manual/current/docbook.css"></link>
      <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"></link>
      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css"></link>
      <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,400italic,600,300italic"></link>
      <link rel="stylesheet" type="text/css" href="https://neo4j.com/docs/developer-manual/current/css/extra.css"></link>
      <link rel="stylesheet" type="text/css" href="https://neo4j.com/docs/developer-manual/current/css/chunked-base.css"></link>
      <link rel="stylesheet" type="text/css" href="https://neo4j.com/docs/developer-manual/current/css/console.css"></link><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js" type="text/javascript"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" type="text/javascript"></script>
      <link rel="shortcut icon" href="https://neo4j.com/wp-content/themes/neo4jweb/favicon.ico"></link>
      <script type='text/javascript'
   src='https://neo4j.com/wp-content/themes/neo4jweb/assets/js/vendor/codemirror.min.js?ver=4.5.2'></script>
        </head>
   <body>
      <header style="top: 0px;">
         <a href="../part-0/" id="logo"><img src="https://neo4j.com/wp-content/themes/neo4jweb/assets/images/neo4j-logo-2015.png" alt="Neo4j Logo"></a>
         <ul class="documentation-library">
            <li id="menu-module-1">
              <a href="../part-1/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">1</strong>
              </span>
              Intro to Graph DBs</a>
            </li>
            <li id="menu-module-2">
              <a href="../part-2/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">2</strong>
              </span>
              Intro to Neo4j</a>
            </li>
            <li id="menu-module-3">
              <a href="../part-3/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">3</strong>
              </span>
              Dev Env</a>
            </li>
            <li id="menu-module-4">
              <a href="../part-4/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">4</strong>
              </span>
              Cypher</a>
            </li>
            <li id="menu-module-5">
              <a href="../part-5/" style="color: #000">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">5</strong>
              </span>
              Advanced Queries</a>
            </li>
            <li id="menu-module-6">
              <a href="../part-6/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">6</strong>
              </span>
              Creating Data</a>
            </li>
            <li id="menu-module-7">
              <a href="../part-7/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">7</strong>
              </span>
              More</a>
            </li>
            <li>
              <a href="../part-8/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">8</strong>
              </span>
              The End</a>
            </li>
         </ul>
         <nav id="header-nav">
         <span class="nav-previous">
           
              <a accesskey="p" href="../part-4/">
                <span class="fa fa-long-arrow-left" aria-hidden="true"></span>
              Intro to Cypher</a>
           
         </span>
         <span class="nav-current">
           <p class="nav-title" style="display: none;"></p>
         </span>
         <span class="nav-next">
           
              <a accesskey="n" href="../part-6/">Writing Data
                <span class="fa fa-long-arrow-right" aria-hidden="true"></span>
              </a>
           
         </span>
         </nav>
      </header>


<div id="developer-manual" style="padding-top: 150px; padding-left: 20px; padding-bottom: 100px;">
<h1>Getting More Out of Queries</h1>

      <div id="preamble columns medium-12">
<div class="sectionbody">
<script type='text/javascript'>
	var loc = window.location;
	document.write(unescape("%3Cscript src='https://munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
</script>

<script>Munchkin.init('773-GON-065');</script>


<style>
    @import "https://neo4j.com/online_training/cypher-gadget/libs/jquery.modal.min.css" screen;
    .modal {
        width: 775px;
        height: 775px;
        padding: 10px;
        margin: 0;
    }
    .blocker {
        height: initial;
        background-color: transparent;
    }
  a.button {
    display: block;
    text-align: center;
    width: 250px;
    font-size: 18px;
    margin-top: 50px;
    font-family: 'Open Sans';
    height: 55px;
    border-style: solid;
    border-width: 0;
    cursor: pointer;
    color: white;
    padding: 15px;
    font-weight: 300;
    background-color: #6dcc9c;
    border-color: #4ac084;
  }

  .button a hover {
      background-color: #4ac084;
  }

  pre.cypher-syntax {
    background-color: #eaf1f8;
  }
</style>
<script src="https://neo4j.com/online_training/cypher-gadget/libs/underscore.js"></script>
<script src="https://neo4j.com/online_training/cypher-gadget/libs/jquery.js"></script>
<script src="https://neo4j.com//online_training/cypher-gadget/libs/jquery-ui.min.js"></script>
<script src="https://neo4j.com/online_training/cypher-gadget/libs/jquery.modal.min.js"></script>
<script src="https://neo4jsandbox.com/js/js.cookie-2.1.3.min.js"></script>
<!--script src="/online_training/gadgetUtils.js"></script-->
<script src="https://neo4j.com/online_training/tasks.js"></script>
<script type="text/javascript">
function renderGadget(containerSelector, options) {
  if (!options.cypherSetup) return;
  var frameId = _.uniqueId("exmodal");
  $(containerSelector).append('<button onclick="setGadgetUrl(\'#' + frameId +
    '\')" rel="modal:open" class="btn">' + (options.label || 'Gadget') + '</button>');

    $(containerSelector).append(modalWindow(frameId,options));
  }

function modalWindow(frameId, options) {
   return `<div id="${frameId}" class="modal-dialog modal fade draggable" style="display:none;text-align:center;vertical-align:middle;" >
            <iframe data-src="/online_training/cypher-gadget/test.html?cypherSetup=${options.cypherSetup}&${formatTask(options)}" width="725" height="725" frameborder="0" style="margin:5px;"
              webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
           <div>`;
}
/*
    .modal {
        width: 775px;
        height: 675px;
        padding: 10px;
        margin: 0;
    }
*/

function formatTask(options) {
  if (options.task) return "cypherTaskJSON="+encodeURIComponent(JSON.stringify(options.task));
  if (options.taskName) return "cypherTask="+options.taskName;
  return "";
}


function setGadgetUrl(sel) {
  $(sel).modal();
  $(sel).draggable();
  var $iframe = $(sel).find("iframe");
  $iframe.attr("src", $iframe.data("src"));
}
</script>
</div>
</div>
<div  id="_about_this_module" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>About this module</h3>


<div class="paragraph">
<p>You have learned how to query nodes and relationships in a graph using simple patterns.
You learned how to use node labels, relationship types, and properties to filter your queries.
Cypher provides a rich set of <code>MATCH</code> clauses and keywords you can use to get more out of your queries.</p>
</div>


<div class="paragraph">
<p>At the end of this module, you should be able to write Cypher statements to:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
Filter queries using the <code>WHERE</code> clause
</li>
<li>
Control query processing
</li>
<li>
Control what results are returned
</li>
<li>
Work with Cypher lists and dates
</li>
</ul>
</div>
<div  id="_filtering_queries_using_where" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Filtering queries using <code>WHERE</code></h3>


<div class="paragraph">
<p>You have learned how to specify values for properties of nodes and relationships to filter what data is returned from the <code>MATCH</code> and <code>RETURN</code> clauses.
The format for filtering you have learned thus far only tests equality, where you must specify values for the properties to test with.
What if you wanted more flexibility about how the query is filtered?
For example, you want to retrieve all movies released after 2000, or retrieve all actors born after 1970 who acted in movies released before 1995.
Most applications need more flexibility in how data is filtered.</p>
</div>


<div class="paragraph">
<p>The most common clause you use to filter queries is the <code>WHERE</code> clause that follows a <code>MATCH</code> clause.
In the <code>WHERE</code> clause, you can place conditions that are evaluated at runtime to filter the query.</p>
</div>


<div class="paragraph">
<p>Previously, you learned to write simple query as follows:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;(m:Movie {released: 2008})
RETURN p, m</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is one way you specify the same query using the <code>WHERE</code> clause:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;(m:Movie)
WHERE m.released = 2008
RETURN p, m</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>In this example, you can only refer to named nodes or relationships in a <code>WHERE</code> clause so remember that you must specify a variable for any node or relationship you are testing in the <code>WHERE</code> clause.
The benefit of using a <code>WHERE</code> clause is that you can specify potentially complex conditions for the query.</p>
</div>


<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;(m:Movie)
WHERE m.released = 2008 OR m.released = 2009
RETURN p, m</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->
<div  id="_specifying_ranges_in_where_clauses" class="sect3 "  >
<h4>Specifying ranges in WHERE clauses</h4>


<div class="paragraph">
<p>Not only can the equality <code>=</code> be tested, but you can test ranges, existence, strings, as well as specify logical operations during the query.</p>
</div>


<div class="paragraph">
<p>Here is an example of specifying a range for filtering the query:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;(m:Movie)
WHERE m.released &gt;= 2003 AND m.released &lt;= 2004
RETURN p.name, m.title, m.released</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/MoviesBetween2003And2004.png" alt="MoviesBetween2003And2004" width="800">
</p>
</div>


<div class="paragraph">
<p>You can also specify the same query as:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;(m:Movie)
WHERE 2003 &lt;= m.released &lt;= 2004
RETURN p.name, m.title, m.released</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>You can specify conditions in a <code>WHERE</code> clause that return a value of <code>true</code> or <code>false</code> (for example predicates).
For testing numeric values, you use the standard numeric comparison operators. Each condition can be combined for runtime evaluation using the boolean operators <code>AND</code>, <code>OR</code>, <code>XOR</code>, and <code>NOT</code>.
There are a number of numeric functions you can use in your conditions.
See the <em>Developer Manual&#8217;s</em> section <em>Mathematical Functions</em> for more information.</p>
</div>


<div class="paragraph">
<p>A special condition in a query is when the retrieval returns an unknown value called <code>null</code>.
You should read the <em>Developer Manual&#8217;s</em> section <em>Working with null</em> to understand how  <code>null</code> values are used at runtime.</p>
</div>
</div>
<div  id="_testing_labels" class="sect3 "  >
<h4>Testing labels</h4>


<div class="paragraph">
<p>Thus far, you have used the node labels to filter queries in a <code>MATCH</code> clause.
You can filter node labels in the <code>WHERE</code> clause also:</p>
</div>


<div class="paragraph">
<p>For example, these two Cypher queries:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)
RETURN p.name</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;(:Movie {title: 'The Matrix'})
RETURN p.name</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>can be rewritten using <code>WHERE</code> clauses as follows:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p)
WHERE p:Person
RETURN p.name</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p)-[:ACTED_IN]-&gt;(m)
WHERE p:Person AND m:Movie AND m.title='The Matrix'
RETURN p.name</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Not all node labels need to be tested during a query, but if your graph has multiple labels for the same node, filtering it by the node label will provide better query performance.</p>
</div>
</div>
<div  id="_testing_the_existence_of_a_property" class="sect3 "  >
<h4>Testing the existence of a property</h4>


<div class="paragraph">
<p>Recall that a property is associated with a particular node or relationship.
A property is not associated with a node with a particular label or relationship type.
In one of our queries earlier, we saw that the movie "Something&#8217;s Gotta Give" is the only movie in the <em>Movie</em> database that does not have a <em>tagline</em> property.
Suppose we only want to return the movies that the actor, <em>Jack Nicholson</em> acted in with the condition that they must all have a tagline.</p>
</div>


<div class="paragraph">
<p>Here is the query to retrieve the specified movies where we test the existence of the <em>tagline</em> property:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;(m:Movie)
WHERE p.name='Jack Nicholson' AND exists(m.tagline)
RETURN m.title, m.tagline</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/JackNicholsonMoviesWithTaglines.png" alt="JackNicholsonMoviesWithTaglines" width="900">
</p>
</div>
</div>
<div  id="_testing_strings" class="sect3 "  >
<h4>Testing strings</h4>


<div class="paragraph">
<p>Cypher has a set of string-related keywords that you can use in your <code>WHERE</code> clauses to test string property values.
You can specify <code>STARTS WITH</code>, <code>ENDS WITH</code>, and <code>CONTAINS</code>.</p>
</div>


<div class="paragraph">
<p>For example, to find all actors in the <em>Movie</em> database whose first name is <em>Michael</em>, you would write:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;()
WHERE p.name STARTS WITH 'Michael'
RETURN p.name</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/ActorsNamedMichael.png" alt="ActorsNamedMichael" width="800">
</p>
</div>


<div class="paragraph">
<p>Note that the comparison of strings is case-sensitive.
There are a number of string-related functions you can use to further test strings.
For example, if you want to test a value, regardless of its case, you could call the <code>toLower()</code> function to convert the string to lower case before it is compared.</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;()
WHERE toLower(p.name) STARTS WITH 'michael'
RETURN p.name</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
In this example where we are converting a property to lower case, if an index has been created for this property, it will not be used at runtime.
</td>
</tr>
</table>
</div>


<div class="paragraph">
<p>See the <em>String functions</em> section of the <em>Developer Manual</em> for more information.
It is sometimes useful to use the built-in string functions to modify the data that is returned in the query in the RETURN clause.</p>
</div>
</div>
<div  id="_testing_with_regular_expressions" class="sect3 "  >
<h4>Testing with regular expressions</h4>


<div class="paragraph">
<p>If you prefer, you can test property values using regular expressions.
You use the syntax <code>=~</code> to specify the regular expression you are testing with.
Here is an example where we test the name of the <em>Person</em> using a regular expression to retrieve all <em>Person</em> nodes with a <em>name</em> property that begins with 'Tom':</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)
WHERE p.name =~'Tom.*'
RETURN p.name</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/MatchTomsRegex.png" alt="MatchTomsRegex" width="800">
</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
If you specify a regular expression. The index will never be used. In addition, the property value must fully match the regular expression.
</td>
</tr>
</table>
</div>
</div>
<div  id="_testing_with_patterns" class="sect3 "  >
<h4>Testing with patterns</h4>


<div class="paragraph">
<p>Sometimes during a query, you may want to perform additional filtering using the relationships between nodes being visited during the query. For example, during retrieval, you may want to exclude certain paths traversed.
You can specify a <code>NOT</code> specifier on a pattern in a <code>WHERE</code> clause.</p>
</div>


<div class="paragraph">
<p>Here is an example where we want to return all <em>Person</em> nodes of people who wrote movies:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)-[:WROTE]-&gt;(m:Movie)
RETURN p.name, m.title</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/WroteMovies.png" alt="WroteMovies" width="800">
</p>
</div>


<div class="paragraph">
<p>Next, we modify this query to exclude people who directed that movie:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)-[:WROTE]-&gt;(m:Movie)
WHERE NOT exists( (p)-[:DIRECTED]-&gt;() )
RETURN p.name, m.title</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/WroteMoviesNotDirected.png" alt="WroteMoviesNotDirected" width="800">
</p>
</div>


<div class="paragraph">
<p>Here is another example where we want to find <em>Gene Hackman</em> and the movies that he acted in with another person who also directed the movie.</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (gene:Person)-[:ACTED_IN]-&gt;(m:Movie)&lt;-[:ACTED_IN]-(other:Person)
WHERE gene.name= 'Gene Hackman'
AND exists( (other)-[:DIRECTED]-&gt;() )
RETURN  gene, other, m</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/ExistsPattern.png" alt="ExistsPattern" width="600">
</p>
</div>
</div>
<div  id="_testing_with_list_values" class="sect3 "  >
<h4>Testing with list values</h4>


<div class="paragraph">
<p>If you have a set of values you want to test with, you can place them in a list or you can test with an existing list in the graph.</p>
</div>


<div class="paragraph">
<p>You can define the list in the <code>WHERE</code> clause.
During the query, the graph engine will compare each property with the values <code>IN</code> the list.
You can place either numeric or string values in the list, but typically, elements of the list are of the same type of data.
If you are testing with a property of a string type, then all the elements of the list should be strings.</p>
</div>


<div class="paragraph">
<p>In this example, we only want to retrieve <em>Person</em> nodes of people born in 1965 or 1970:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)
WHERE p.born IN [1965, 1970]
RETURN p.name as name, p.born as yearBorn</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/UsingIN.png" alt="UsingIN" width="800">
</p>
</div>


<div class="paragraph">
<p>You can also compare a value to an existing list in the graph.</p>
</div>


<div class="paragraph">
<p>We know that the <em>:ACTED_IN</em> relationship has a property, <em>roles</em> that contains the list of roles an actor had in a particular movie they acted in.
Here is the query we write to return the name of the actor who played <em>Neo</em> in the movie <em>The Matrix</em>:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)-[r:ACTED_IN]-&gt;(m:Movie)
WHERE  'Neo' IN r.roles AND m.title='The Matrix'
RETURN p.name</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/UsingINRoles.png" alt="UsingINRoles" width="800">
</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
There are a number of syntax elements of Cypher that we have not covered in this training. For example, you can specify <code>CASE</code> logic in your conditional testing for your <code>WHERE</code> clauses. You can learn more about these syntax elements in the <em>Developer Manual</em>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div  id="_exercise_4_filtering_queries_using_the_where_clause" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise 4: Filtering queries using the <code>WHERE</code> clause</strong></h3>


<div class="paragraph">
<p>In the query edit pane of Neo4j Browser, execute the browser command: <kbd>:play intro-neo4j-exercises</kbd>
and follow the instructions for Exercise 4.</p>
</div>
</div>
<div  id="_controlling_query_processing" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Controlling query processing</h3>


<div class="paragraph">
<p>Now that you have learned how to provide filters for your queries by testing properties, relationships, and patterns using the <code>WHERE</code> clause, you will learn some additional Cypher techniques for controlling what the graph engine does during the query.</p>
</div>
<div  id="_specifying_multiple_match_patterns" class="sect3 "  >
<h4>Specifying multiple <code>MATCH</code> patterns</h4>


<div class="paragraph">
<p>This <code>MATCH</code> clause includes a pattern  specified by two paths separated by a comma:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (a:Person)-[:ACTED_IN]-&gt;(m:Movie),
      (m:Movie)&lt;-[:DIRECTED]-(d:Person)
WHERE m.released = 2000
RETURN a.name, m.title, d.name</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>If possible, you should write the same query as follows:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (a:Person)-[:ACTED_IN]-&gt;(m:Movie)&lt;-[:DIRECTED]-(d:Person)
WHERE m.released = 2000
RETURN a.name, m.title, d.name</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>There are, however, some queries where you will need to specify two or more patterns.
Multiple patterns are used when a query is complex and cannot be satisfied with a single pattern.
This is useful when you are looking for a specific node in the graph and want to connect it to a different node.
You will learn about creating nodes and relationships later in this training.</p>
</div>
</div>
<div  id="_example_1_using_two_match_patterns" class="sect3 "  >
<h4>Example 1: Using two MATCH patterns</h4>


<div class="paragraph">
<p>Here are some examples of specifying two paths in a <code>MATCH</code> clause.
In the first example, we want the actors that worked with <em>Keanu Reeves</em> to meet <em>Hugo Weaving</em>, who has worked with <em>Keanu Reeves</em>.
Here we retrieve the actors who acted in the same movies as <em>Keanu Reeves</em>, but not when <em>Hugo Weaving</em> acted in the same movie.
To do this, we specify two paths for the <code>MATCH</code>:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (keanu:Person)-[:ACTED_IN]-&gt;(movie:Movie)&lt;-[:ACTED_IN]-(n:Person),
     (hugo:Person)
WHERE keanu.name='Keanu Reeves' AND
      hugo.name='Hugo Weaving'
AND NOT (hugo)-[:ACTED_IN]-&gt;(movie)
RETURN n.name</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>When you perform this type of query, you may see a warning in the query edit pane stating that the pattern represents a cartesian product and may require a lot of resources to perform the query.
You should only perform these types of queries if you know the data well and the implications of doing the query.</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/CartesionProductWarning.png" alt="CartesionProductWarning" width="700">
</p>
</div>


<div class="paragraph">
<p>Here is the result of executing this query:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/KeanuFriendsForHugo.png" alt="KeanuFriendsForHugo" width="600">
</p>
</div>
</div>
<div  id="_example_2_using_two_match_patterns" class="sect3 "  >
<h4>Example 2: Using two MATCH patterns</h4>


<div class="paragraph">
<p>Here is another example where two patterns are necessary.
Suppose we want to retrieve the movies that <em>Meg Ryan</em> acted in and their respective directors, as well as the other actors that acted in these movies.
Here is the query to do this:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (meg:Person)-[:ACTED_IN]-&gt;(m:Movie)&lt;-[:DIRECTED]-(:Person),
      (:Person)-[:ACTED_IN]-&gt;(m)
WHERE meg.name = 'Meg Ryan'
RETURN m.title as movie, d.name AS director , other.name AS `co-actors`</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/MegsCoActors.png" alt="MegsCoActors" width="800">
</p>
</div>
</div>
<div  id="_setting_path_variables" class="sect3 "  >
<h4>Setting path variables</h4>


<div class="paragraph">
<p>You have previously seen how you can assign a path used in a <code>MATCH</code> clause to a variable. This is useful if you want to reuse the path later in the same query or if you want to return the path. So the previous Cypher statement could return the path as follows:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH megPath = (meg:Person)-[:ACTED_IN]-&gt;(m:Movie)&lt;-[:DIRECTED]-(d:Person),
      (other:Person)-[:ACTED_IN]-&gt;(m)
WHERE meg.name = 'Meg Ryan'
RETURN megPath</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/MegPath.png" alt="MegPath" width="800">
</p>
</div>
</div>
<div  id="_specifying_varying_length_paths" class="sect3 "  >
<h4>Specifying varying length paths</h4>


<div class="paragraph">
<p>Any graph that represents social networking, trees, or hierarchies will most likely have multiple paths of varying lengths.
Think of the <em>connected</em> relationship in <em>LinkedIn</em> and how connections are made by people connected to more people.
The <em>Movie</em> database for this training does not have much depth of relationships, but it does have the <em>:FOLLOWS</em> relationship that you learned about earlier:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/FollowsRelationships.png" alt="FollowsRelationships" width="500">
</p>
</div>


<div class="paragraph">
<p>You write a <code>MATCH</code> clause where  you want to find all of the followers of the followers of a <em>Person</em> by specifying a numeric value for the number of hops in the path.
Here is an example where we want to retrieve all <em>Person</em> nodes that are exactly two hops away:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (follower:Person)-[:FOLLOWS*2]-&gt;(p:Person)
WHERE follower.name = 'Paul Blythe'
RETURN p</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/TwoHopRelationship.png" alt="TwoHopRelationship" width="700">
</p>
</div>


<div class="paragraph">
<p>If we had specified <code>[:FOLLOWS*]</code> rather than <code>[:FOLLOWS*2]</code>, the query would return all <em>Person</em> nodes that are two hops away in the <code>:FOLLOWS</code> path from <em>Paul Blythe</em>.</p>
</div>


<div class="paragraph">
<p>Here are simplified syntax examples for how varying length patterns are specified in Cypher:</p>
</div>


<div class="paragraph">
<p>Retrieve <span class="underline">all</span> paths of any length with the relationship, <em>:RELTYPE</em> from <em>nodeA</em> to <em>nodeB</em> and beyond:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher-syntax">(nodeA)-[:RELTYPE*]-&gt;(nodeB)</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Retrieve <span class="underline">all</span> paths of any length with the relationship, <em>:RELTYPE</em> from <em>nodeA</em> to <em>nodeB</em> or from <em>nodeB</em> to <em>nodeA</em> and beyond. This is usually a very expensive query so you should place limits on how many nodes are retrieved:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher-syntax">(nodeA)-[:RELTYPE*]-(nodeB)</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Retrieve the paths of length 3 with the relationship, <em>:RELTYPE</em> from <em>nodeA</em> to <em>nodeB</em>:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher-syntax">(node1)-[:RELTYPE*3]-&gt;(node2)</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Retrieve the paths of lengths 1, 2, or 3 with the relationship, <em>:RELTYPE</em> from <em>nodeA</em> to <em>nodeB</em>, <em>nodeB</em> to <em>nodeC</em>, as well as, <em>nodeC</em> to _nodeD) (up to three hops):</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher-syntax">(node1)-[:RELTYPE*1..3]-&gt;(node2)</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>You can learn more about varying paths in the <em>Patterns</em> section of the <em>Developer Manual</em>.</p>
</div>
</div>
<div  id="_finding_the_shortest_path" class="sect3 "  >
<h4>Finding the shortest path</h4>


<div class="paragraph">
<p>A built-in function that you may find useful in a graph that has many ways of traversing the graph to get to the same node is the <code>shortestPath()</code> function. Using the shortest path between two nodes improves the performance of the query.</p>
</div>


<div class="paragraph">
<p>In this example, we want to discover a shortest path between the movies <em>The Matrix</em> and <em>A Few Good Men</em>. In our <code>MATCH</code> clause, we set the variable <em>p</em> to the result of calling <code>shortestPath()</code>, and then return <em>p</em>. In the call to <code>shortestPath()</code>, notice that we specify <code>*</code> for the relationship. This means any relationship; for the traversal.</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH p = shortestPath((m1:Movie)-[*]-(m2:Movie))
WHERE m1.title = 'A Few Good Men' AND
      m2.title = 'The Matrix'
RETURN  p</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/ShortestPath1.png" alt="ShortestPath1" width="700">
</p>
</div>


<div class="paragraph">
<p>Notice that the graph engine has traversed many types of relationships to get to the end node.</p>
</div>


<div class="paragraph">
<p>When you use the <code>shortestPath()</code> function, the query editor will show a warning that this type of query could potentially run for a long time. You should heed the warning, especially for large graphs. Read the <em>Graph Algorithms</em> documentation about the shortest path algorithm.</p>
</div>


<div class="paragraph">
<p>When you use <code>ShortestPath()</code>, you can specify a upper limits for the shortest path. In addition, you should aim to provide the patterns for the from an to nodes that execute efficiently. For example, use labels and indexes.</p>
</div>
</div>
<div  id="_specifying_optional_pattern_matching" class="sect3 "  >
<h4>Specifying optional pattern matching</h4>


<div class="paragraph">
<p><code>OPTIONAL MATCH</code> matches patterns with your graph, just like <code>MATCH</code> does.
The difference is that if no matches are found, <code>OPTIONAL MATCH</code> will use NULLs for missing parts of the pattern.
<code>OPTIONAL MATCH</code> could be considered the Cypher equivalent of the outer join in SQL.</p>
</div>


<div class="paragraph">
<p>Here is an example where we query the graph for all people whose name starts with <em>James</em>.
The <code>OPTIONAL MATCH</code> is specified to include people who have reviewed movies:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)
WHERE p.name STARTS WITH 'James'
OPTIONAL MATCH (p)-[r:REVIEWED]-&gt;(m:Movie)
RETURN p.name, type(r), m.title</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/OptionalMatch.png" alt="OptionalMatch" width="800">
</p>
</div>


<div class="paragraph">
<p>Notice that for all rows that do not have the <em>:REVIEWED</em> relationship, a <em>null</em> value is returned for the movie part of the query, as well as the relationship.</p>
</div>
</div>
<div  id="_aggregation_in_cypher" class="sect3 "  >
<h4>Aggregation in Cypher</h4>


<div class="paragraph">
<p>Aggregation in Cypher is different from aggregation in SQL. In Cypher, you need not specify a grouping key. As soon as an aggregation function is used, all non-aggregated properties become grouping keys. The grouping is explicitly done, based upon the fields in the <code>RETURN</code> clause.</p>
</div>


<div class="paragraph">
<p>For example, in this Cypher statement, all rows returned with the same values for <em>a.name</em> and <em>d.name</em> are counted and only returned once.</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">// implicitly groups by a.name and d.name
MATCH (a)-[:ACTED_IN]-&gt;(m)&lt;-[:DIRECTED]-(d)
RETURN a.name, d.name, count(*)</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>With this result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/Aggregation.png" alt="Aggregation" width="800">
</p>
</div>
</div>
<div  id="_collecting_results" class="sect3 "  >
<h4>Collecting results</h4>


<div class="paragraph">
<p>Cypher has a built-in function, <code>collect()</code> that enables you to aggregate a value into a list.
Here is an example where we collect the list of movies that <em>Tom Cruise</em> acted in:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)-[:ACTED_IN]-&gt;(m:Movie)
WHERE p.name ='Tom Cruise'
RETURN collect(m.title) AS `movies for Tom Cruise`</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/TomCruiseMovieCollection.png" alt="TomCruiseMovieCollection" width="800">
</p>
</div>


<div class="paragraph">
<p>In Cypher, there is no "GROUP BY" clause as there is in SQL. The graph engine uses non-aggregated columns as an automatic grouping key.</p>
</div>
</div>
<div  id="_counting_results" class="sect3 "  >
<h4>Counting results</h4>


<div class="paragraph">
<p>The Cypher <code>count()</code> function is very useful when you want to count the number of occurrences of a particular query result.
If you specify <code>count(n)</code>, the graph engine calculates the number of occurrences of <em>n</em>.
If you specify <code>count(*)</code>, the graph engine calculates the number of rows retrieved, including those with <code>null</code> values.
When you use <code>count(_)</code>, the graph engine does an implicit group by based upon the aggregation.</p>
</div>


<div class="paragraph">
<p>Here is an example where we count the paths retrieved where an actor and director collaborated in a movie and the <code>count()</code> function is used to count the number of paths found for each actor/director collaboration.</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (actor:Person)-[:ACTED_IN]-&gt;(m:Movie)&lt;-[:DIRECTED]-(director:Person)
RETURN actor.name, director.name, count(m) AS collaborations, collect(m.title) AS movies</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/ActorDirectorCollaborations.png" alt="ActorDirectorCollaborations" width="800">
</p>
</div>


<div class="paragraph">
<p>There are more aggregating functions such as <code>min()</code> or <code>max()</code> that you can also use in your queries.
These are described in the <em>Aggregating Functions</em> section of the <em>Developer Manual</em>.</p>
</div>
</div>
<div  id="_additional_processing_using_with" class="sect3 "  >
<h4>Additional processing using <code>WITH</code></h4>


<div class="paragraph">
<p>During the execution of a <code>MATCH</code> clause, you can specify that you want some intermediate calculations or values that will be used for further processing of the query, or for limiting the number of results before further processing is done.
You use the <code>WITH</code> clause to perform intermediate processing or data flow operations.</p>
</div>


<div class="paragraph">
<p>Here is an example where we start the query processing by retrieving all actors and their movies.
During the query processing, want to only return actors that have 2 or 3 movies.
All other actors and the aggregated results are filtered out. This type of query is a replacement for SQL&#8217;s "HAVING" clause.
The <code>WITH</code> clause does the counting and collecting, but is then used in the subsequent <code>WHERE</code> clause to limit how many paths are visited.</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (a:Person)-[:ACTED_IN]-&gt;(m:Movie)
WITH  a, count(a) AS numMovies, collect(m.title) as movies
WHERE numMovies &gt; 1 AND numMovies &lt; 4
RETURN a.name, numMovies, movies</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/ActorsWith2or3Movies.png" alt="ActorsWith2or3Movies" width="800">
</p>
</div>


<div class="paragraph">
<p>When you use the <code>WITH</code> clause, you specify the variables from the previous part of the query you want to pass on to the next part of the query.
In this example, the variable <em>a</em> is specified to be passed on in the query, but <em>m</em> is not. Since <em>m</em> is not specified to be passed on, <em>m</em> will not be available later in the query.
Notice that for the <code>RETURN</code> clause, <em>a</em>, <em>numMovies</em>, and <em>movies</em> are available for use.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
You have to name all expressions with an alias in a <code>WITH</code> that are not simple variables.
</td>
</tr>
</table>
</div>


<div class="paragraph">
<p>Here is another example where we want to find all actors who have acted in at least five movies, and find (optionally) the movies they directed and return the person and those movies.</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)
WITH p, size((p)-[:ACTED_IN]-&gt;(:Movie)) AS movies
WHERE movies &gt;= 5
OPTIONAL MATCH (p)-[:DIRECTED]-&gt;(m:Movie)
RETURN p.name, m.title</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/PopularActorsWithAtLeast5Movies.png" alt="PopularActorsWithAtLeast5Movies" width="800">
</p>
</div>


<div class="paragraph">
<p>In this example, we first retrieve all people, but then specify a pattern in the <code>WITH</code> clause where we calculate the number of <code>:ACTED_IN</code> relationships retrieved using the <code>size()</code> function. If this value is greater than five, we then also retrieve the <code>:DIRECTED</code> paths to return the name of the person and the title of the movie they directed. In the result, we see that these actors acted in more than five movies, but <em>Tom Hanks</em> is the only actor who directed a movie and thus the only person to have a value for the movie.</p>
</div>
</div>
</div>
<div  id="_exercise_5_controlling_query_processing" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise 5: Controlling query processing</strong></h3>


<div class="paragraph">
<p>In the query edit pane of Neo4j Browser, execute the browser command: <kbd>:play intro-neo4j-exercises</kbd>
and follow the instructions for Exercise 5.</p>
</div>
</div>
<div  id="_controlling_how_results_are_returned" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Controlling how results are returned</h3>


<div class="paragraph">
<p>Next, you will learn some additional Cypher techniques for controlling how results are returned from a query.</p>
</div>
<div  id="_eliminating_duplication" class="sect3 "  >
<h4>Eliminating duplication</h4>


<div class="paragraph">
<p>You have seen a number of query results where there is duplication in the results returned.
In most cases, you want to eliminate duplicated results.
You do so by using the <code>DISTINCT</code> keyword.</p>
</div>


<div class="paragraph">
<p>Here is a simple example where duplicate data is returned.
<em>Tom Hanks</em> both acted in and directed the movie, <em>That Thing You Do</em>, so the movie is returned twice in the result stream:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)-[:DIRECTED | :ACTED_IN]-&gt;(m:Movie)
WHERE p.name = 'Tom Hanks'
RETURN m.released, collect(m.title) AS movies</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/Duplication.png" alt="Duplication" width="800">
</p>
</div>


<div class="paragraph">
<p>We can eliminate the duplication by specifying the DISTINCT keyword as follows:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)-[:DIRECTED | :ACTED_IN]-&gt;(m:Movie)
WHERE p.name = 'Tom Hanks'
RETURN m.released, collect(DISTINCT m.title) AS movies</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/NoDuplication.png" alt="NoDuplication" width="800">
</p>
</div>
</div>
<div  id="_using_with_and_distinct_to_eliminate_duplication" class="sect3 "  >
<h4>Using WITH and DISTINCT to eliminate duplication</h4>


<div class="paragraph">
<p>Another way that you can avoid duplication is to with <code>WITH</code> and <code>DISTINCT</code> together as follows:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)-[:DIRECTED | :ACTED_IN]-&gt;(m:Movie)
WHERE p.name = 'Tom Hanks'
WITH DISTINCT m
RETURN m.released, m.title</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/NoDuplication2.png" alt="NoDuplication2" width="500">
</p>
</div>
</div>
<div  id="_ordering_results" class="sect3 "  >
<h4>Ordering results</h4>


<div class="paragraph">
<p>If you want the results to be sorted, you specify the expression to use for the sort using the <code>ORDER BY</code> keyword and whether you want the order to be descending using the <code>DESC</code> keyword.
Ascending order is the default.
Note that you can provide multiple sort expressions and the result will be sorted in that order.
Just as you can use <code>DISTINCT</code> with <code>WITH</code> to eliminate duplication, you can use <code>ORDER BY</code> with <code>WITH</code> to control the sorting of results.</p>
</div>


<div class="paragraph">
<p>In this example, we specify that the release date of the movies for <em>Tom Hanks</em> will be returned in descending order.</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)-[:DIRECTED | :ACTED_IN]-&gt;(m:Movie)
WHERE p.name = 'Tom Hanks'
RETURN m.released, collect(DISTINCT m.title) AS movies ORDER BY m.released DESC</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/Ordering.png" alt="Ordering" width="800">
</p>
</div>
</div>
<div  id="_limiting_the_number_of_results" class="sect3 "  >
<h4>Limiting the number of results</h4>


<div class="paragraph">
<p>Although you can filter queries to reduce the number of results returned, you may also want to limit the number of results.
This is useful if you have very large result sets and you only need to see the beginning or end of a set of ordered results.
You can use the <code>LIMIT</code> keyword to specify the number of results returned. Furthermore, you can use the <code>LIMIT</code> keyword with the <code>WITH</code> clause to limit results.</p>
</div>


<div class="paragraph">
<p>Suppose you want to see the titles of the ten most recently released movies.
You could do so as follows where you limit the number of results using the <code>LIMIT</code> keyword as follows:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (m:Movie)
RETURN m.title as title, m.released as year ORDER BY m.released DESC LIMIT 10</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/Limit.png" alt="Limit" width="800">
</p>
</div>
</div>
<div  id="_controlling_the_number_of_results_using_with" class="sect3 "  >
<h4>Controlling the number of results using WITH</h4>


<div class="paragraph">
<p>Previously, you saw how you can use the <code>WITH</code> clause to perform some intermediate processing during a query. You can use the <code>WITH</code> clause to limit the number of results.</p>
</div>


<div class="paragraph">
<p>In this example, we count the number of movies during the query and we return the results once we have reached 5 movies:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (a:Person)-[:ACTED_IN]-&gt;(m:Movie)
WITH a, count(*) AS numMovies, collect(m.title) as movies
WHERE numMovies = 5
RETURN a.name, numMovies, movies</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/Count5Movies.png" alt="Count5Movies" width="800">
</p>
</div>
</div>
</div>
<div  id="_exercise_6_controlling_results_returned" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise 6: Controlling results returned</strong></h3>


<div class="paragraph">
<p>In the query edit pane of Neo4j Browser, execute the browser command: <kbd>:play intro-neo4j-exercises</kbd>
and follow the instructions for Exercise 6.</p>
</div>
</div>
<div  id="_working_with_cypher_data" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Working with Cypher data</h3>


<div class="paragraph">
<p>Thus far, you have specified both string and numeric types in your Cypher queries.
You have also learned that nodes and relationships can have properties, whose values are structured like JSON objects.
You have also learned that the <code>collect()</code> function can create lists of values or objects where a list is comma-separated and you can use the <code>IN</code> keyword to search for a value in a list.
Next, you will learn more about working with lists and dates in Cypher.</p>
</div>
<div  id="_lists" class="sect3 "  >
<h4>Lists</h4>


<div class="paragraph">
<p>There are many built-in Cypher functions that you can use to build or access elements in lists.
A Cypher <code>map</code> is list of key/value pairs where each element of the list is of the format key: value. For example, a list of months and the number of days per month could be:</p>
</div>


<div class="paragraph">
<p><code>{Jan: 31, Feb: 28, Mar: 31, Apr: 30 , May: 31, Jun: 30 , Jul: 31, Aug: 31, Sep: 30, Oct: 31, Nov: 30, Dec: 31}</code></p>
</div>


<div class="paragraph">
<p>You can collect values for a list during a query and when you return results, you can sort by the size of the list using the <code>size()</code> function as follows:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (a:Person)-[:ACTED_IN]-&gt;(m:Movie)
WITH  m, count(m) AS numCast, collect(a.name) as cast
RETURN m.title, cast, numCast ORDER BY size(cast)</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/CastList.png" alt="CastList" width="800">
</p>
</div>


<div class="paragraph">
<p>You can read more about working with lists in the <em>List Functions</em> section of the <em>Developer Manual</em>.</p>
</div>
</div>
<div  id="_unwinding_lists" class="sect3 "  >
<h4>Unwinding lists</h4>


<div class="paragraph">
<p>There may be some situations where you want to perform the opposite of collecting results, but rather separate the lists into separate rows. This functionality is done using the <code>UNWIND</code> clause.</p>
</div>


<div class="paragraph">
<p>Here is an example where we create a list with three elements, unwind the list and then return the values. Since there are three elements, three rows are returned with the values:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">WITH [1, 2, 3] AS list
UNWIND list AS row
RETURN list, row</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/Unwind3.png" alt="Unwind3" width="600">
</p>
</div>


<div class="paragraph">
<p>Notice that there is no <code>MATCH</code> clause. You need not query the database to execute Cypher statements, but you do need the <code>RETURN</code> clause here to return the calculated values from the Cypher query.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
The <code>UNWIND</code> clause is frequently used when importing data into a graph.
</td>
</tr>
</table>
</div>
</div>
<div  id="_dates" class="sect3 "  >
<h4>Dates</h4>


<div class="paragraph">
<p>Cypher has a built-in <code>date()</code> function, as well as other temporal values and functions that you can use to calculate temporal values. You use a combination of numeric, temporal, spatial, list and string functions to calculate values that are useful to your application.
For example, suppose you wanted to calculate the age of a <em>Person</em> node, given a year they were born (the <em>born</em> property must exist and have a value).</p>
</div>


<div class="paragraph">
<p>Here is example Cypher to retrieve all actors from the graph, and if they have a value for <em>born</em>, calculate the <em>age</em> value.
Notice that the <code>date()</code> function is called and then converted to a string and then an integer to perform the age calculation.</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (actor:Person)-[:ACTED_IN]-&gt;(:Movie)
WHERE exists(actor.born)
// calculate the age
with DISTINCT actor, date().year  - actor.born as age
RETURN actor.name, age as `age today`
   	  ORDER BY actor.born DESC</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result returned:</p>
</div>
<div class="imageblock thumb">
<p class="content">
<img src="https://s3-us-west-1.amazonaws.com/data.neo4j.com/intro-neo4j/img/Age.png" alt="Age" width="800">
</p>
</div>


<div class="paragraph">
<p>Consult the <em>Developer Manual</em> for more information about the built-in functions available for working with data of all types:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
Predicate
</li>
<li>
Scalar
</li>
<li>
List
</li>
<li>
Mathematical
</li>
<li>
String
</li>
<li>
Temporal
</li>
<li>
Spatial
</li>
</ul>
</div>
</div>
</div>
<div  id="_exercise_7_working_with_cypher_data" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise 7: Working with Cypher data</strong></h3>


<div class="paragraph">
<p>In the query edit pane of Neo4j Browser, execute the browser command: <kbd>:play intro-neo4j-exercises</kbd>
and follow the instructions for Exercise 7.</p>
</div>
</div>
</div>
<div  id="module-5" class="sect1 quiz columns medium-12" style='padding-left: 0;' >
<h3>Check your understanding</h3>
<div  id="_question_1" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Question 1</h3>


<div class="paragraph">
<p>Suppose you want to add a <code>WHERE</code> clause at the end of this statement to filter the results retrieved.</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (p:Person)-[rel]-&gt;(m:Movie)&lt;-[:PRODUCED]-(:Person)</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>What variables, can you test in the <code>WHERE</code> clause:</p>
</div>


<div class="paragraph">
<p>Select the correct answers.</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">p</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">rel</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">m</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">PRODUCED</span>
</li>
</ul>
</div>
</div>
<div  id="_question_2" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Question 2</h3>


<div class="paragraph">
<p>Suppose you want to retrieve all movies that have a <em>released</em> property value that is 2000, 2002, 2004, 2006, or 2008.  Here is an incomplete Cypher example to return the <em>title</em> property values of all movies released in these years.</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (m:Movie)
WHERE m.released XX [2000, 2002, 2004, 2006, 2008]
RETURN m.title</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>What keyword do you specify for XX?</p>
</div>


<div class="paragraph">
<p>Select the correct answer.</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">CONTAINS</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">IN</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">IS</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">EQUALS</span>
</li>
</ul>
</div>
</div>
<div  id="_question_3" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Question 3</h3>


<div class="paragraph">
<p>Given this Cypher query:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre style="font-size: 16px; font-weight: 100;"  class="code cm-s-neo" data-lang="cypher">MATCH (a:Person)-[:ACTED_IN]-&gt;(m:Movie)
WITH  m, count(m) AS numMovies, collect(m.title) as movies
WHERE numMovies &gt; 1 AND numMovies &lt; 4
RETURN //??</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>What variables or aliases can be used to return values?</p>
</div>


<div class="paragraph">
<p>Select the correct answers.</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">a</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">m</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">numMovies</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">movies</span>
</li>
</ul>
</div>
</div>
</div>
<div  id="_summary" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Summary</h3>


<div class="paragraph">
<p>You should now be able to write Cypher statements to:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
Filter queries using the <code>WHERE</code> clause
</li>
<li>
Control query processing
</li>
<li>
Control what results are returned
</li>
<li>
Work with Cypher lists and dates
</li>
</ul>
</div>
</div>
<div  id="_grade_quiz_and_continue" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Grade Quiz and Continue</h3>
<a class="next-section medium button" href="../part-6/">Continue to Module 6</a>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<script src="https://js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>

<script>
window.trainingClassName = 'online-training-v2';
</script>

<script src="https://graphacademy.neo4j.com/training-classes/js/classes-v2.js" type="text/javascript"></script>
<script src="https://graphacademy.neo4j.com/training-quizes/js/quizes-v2.js" type="text/javascript"></script>

 <link rel='stylesheet' id='neo-codemirror-css'
    href="https://neo4j.com/wp-content/themes/neo4jweb/assets/css/codemirror-neo.css?ver=4.5" type='text/css'
    media='screen'/>

 <script type='text/javascript'>
  var isBlock = /^(p|li|div|h\\d|pre|blockquote|td)$/;

  function textContent(node, out) {
    if (node.nodeType == 3) return out.push(node.nodeValue);
    for (var ch = node.firstChild; ch; ch = ch.nextSibling) {
      textContent(ch, out);
      if (isBlock.test(node.nodeType)) out.push("\n");
    }
  }

  CodeMirror.colorize = function(collection, defaultMode) {
    if (!collection) collection = document.body.getElementsByTagName("pre");

    for (var i = 0; i < collection.length; ++i) {
      var syntax = false;
      var node = collection[i];
      var mode = node.getAttribute("data-lang") || defaultMode;
      if (mode == "cypher-syntax") {
        syntax = true;
        mode = "cypher";
      }
      if (!mode) continue;

      var text = [];
      textContent(node, text);
      node.innerHTML = "";
      CodeMirror.runMode(text.join(""), mode, node);

      node.className += " cm-s-default";
      if (syntax) {
        node.className += " cypher-syntax";
      }
    }
  };

  $( document ).ready(function() {
    if (CodeMirror.colorize) {
      CodeMirror.colorize(document.body.getElementsByTagName("pre"), 'cypher');
    }
  });
 </script>


<script>
  window.intercomSettings = {
    app_id: "dt0ig5ab",
    hide_default_launcher: true
  };
</script>
<script>(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',intercomSettings);}else{var d=document;var i=function(){i.c(arguments)};i.q=[];i.c=function(args){i.q.push(args)};w.Intercom=i;function l(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/dt0ig5ab';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);}if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})()</script>

<!-- JWT decoder: ONLY USE TO SEE UN-VERIFIED VALUES -->
<script src="https://neo4jsandbox.com/js/jwt-decode.min.js"></script>


<script>
const SITE_URL = window.location;

var getTimeDiff = function(time1, time2) {
  var hourDiff = time2 - time1;
  var diffDays = Math.floor(hourDiff / 86400000);
  var diffHrs = Math.floor((hourDiff % 86400000) / 3600000);
  var diffMins = Math.floor(((hourDiff % 86400000) % 3600000) / 60000);
  return {"days": diffDays, "hours": diffHrs, "mins": diffMins};
}

var attemptRenewToken = function(silent, nextTimeout, nextTimeoutSilent) {
  console.log('renewAuth attempting');
  var iframe = document.createElement('iframe');
  iframe.style.display = 'none';
  iframe.src = 'https://neo4j.com/accounts/login?targetUrl=' + encodeURIComponent(SITE_URL);
  document.body.appendChild(iframe);
  if (nextTimeout) {
      setTimeout(
        function () {
          attemptRenewToken(nextTimeoutSilent, nextTimeout, nextTimeoutSilent);
        }, nextTimeout
      );
  }
}

var logout = function() {
  window.location = 'https://neo4j.com/graphacademy/online-training/introduction-to-neo4j/'
}

$( document ).ready(function() {
    var id_token = Cookies.get("com.neo4j.accounts.idToken");
    var decoded_token = jwt_decode(id_token);
    var expiresIn = getTimeDiff(Date.now(), (decoded_token.exp) * 1000);
    if (expiresIn.days > 0 || expiresIn.hours > 0) {
      // token is good.
    } else if (expiresIn.days == 0 && expiresIn.hours == 0 && expiresIn.mins > 1 && expiresIn.mins < 60) {
        // expiring soon, let's immediately get a new token
        attemptRenewToken(true, 1000*60*30, false);
    } else {
        // token is already expired, log user out in UI; token won't work
        logout();
    }


    var userInfoIntercom = Cookies.getJSON("com.neo4j.accounts.userInfo");
    if (userInfoIntercom) {
      try {
        window.Intercom("update", {
          app_id: "dt0ig5ab",
          name: userInfoIntercom.name,
          email: userInfoIntercom.email,
          user_id: userInfoIntercom.sub,
          hide_default_launcher: true
        });;
      } catch (err) {
        console.error(err);
      }
    }
    Intercom('trackEvent','training-introv2-view');
});
</script>
<script>
$( document ).ready(function() {
  Intercom('trackEvent','training-introv2-view-part5');
});
</script>
</div>
</div>
<div id="sidebar-wrapper">
        
        <div id="toc" class="toc2">
        <div id="toctitle">Module: Getting More Out of Queries</div>
        <ul class="sectlevel1">
<li><a href="#_about_this_module">About this module</a>
<ul class="sectlevel2">
<li><a href="#_filtering_queries_using_where">Filtering queries using <code>WHERE</code></a>
<ul class="sectlevel3">
<li><a href="#_specifying_ranges_in_where_clauses">Specifying ranges in WHERE clauses</a></li>
<li><a href="#_testing_labels">Testing labels</a></li>
<li><a href="#_testing_the_existence_of_a_property">Testing the existence of a property</a></li>
<li><a href="#_testing_strings">Testing strings</a></li>
<li><a href="#_testing_with_regular_expressions">Testing with regular expressions</a></li>
<li><a href="#_testing_with_patterns">Testing with patterns</a></li>
<li><a href="#_testing_with_list_values">Testing with list values</a></li>
</ul>
</li>
<li><a href="#_exercise_4_filtering_queries_using_the_where_clause"><strong>Exercise 4: Filtering queries using the <code>WHERE</code> clause</strong></a></li>
<li><a href="#_controlling_query_processing">Controlling query processing</a>
<ul class="sectlevel3">
<li><a href="#_specifying_multiple_match_patterns">Specifying multiple <code>MATCH</code> patterns</a></li>
<li><a href="#_example_1_using_two_match_patterns">Example 1: Using two MATCH patterns</a></li>
<li><a href="#_example_2_using_two_match_patterns">Example 2: Using two MATCH patterns</a></li>
<li><a href="#_setting_path_variables">Setting path variables</a></li>
<li><a href="#_specifying_varying_length_paths">Specifying varying length paths</a></li>
<li><a href="#_finding_the_shortest_path">Finding the shortest path</a></li>
<li><a href="#_specifying_optional_pattern_matching">Specifying optional pattern matching</a></li>
<li><a href="#_aggregation_in_cypher">Aggregation in Cypher</a></li>
<li><a href="#_collecting_results">Collecting results</a></li>
<li><a href="#_counting_results">Counting results</a></li>
<li><a href="#_additional_processing_using_with">Additional processing using <code>WITH</code></a></li>
</ul>
</li>
<li><a href="#_exercise_5_controlling_query_processing"><strong>Exercise 5: Controlling query processing</strong></a></li>
<li><a href="#_controlling_how_results_are_returned">Controlling how results are returned</a>
<ul class="sectlevel3">
<li><a href="#_eliminating_duplication">Eliminating duplication</a></li>
<li><a href="#_using_with_and_distinct_to_eliminate_duplication">Using WITH and DISTINCT to eliminate duplication</a></li>
<li><a href="#_ordering_results">Ordering results</a></li>
<li><a href="#_limiting_the_number_of_results">Limiting the number of results</a></li>
<li><a href="#_controlling_the_number_of_results_using_with">Controlling the number of results using WITH</a></li>
</ul>
</li>
<li><a href="#_exercise_6_controlling_results_returned"><strong>Exercise 6: Controlling results returned</strong></a></li>
<li><a href="#_working_with_cypher_data">Working with Cypher data</a>
<ul class="sectlevel3">
<li><a href="#_lists">Lists</a></li>
<li><a href="#_unwinding_lists">Unwinding lists</a></li>
<li><a href="#_dates">Dates</a></li>
</ul>
</li>
<li><a href="#_exercise_7_working_with_cypher_data"><strong>Exercise 7: Working with Cypher data</strong></a></li>
</ul>
</li>
<li><a href="#module-5">Check your understanding</a>
<ul class="sectlevel2">
<li><a href="#_question_1">Question 1</a></li>
<li><a href="#_question_2">Question 2</a></li>
<li><a href="#_question_3">Question 3</a></li>
</ul>
</li>
<li><a href="#_summary">Summary</a></li>
<li><a href="#_grade_quiz_and_continue">Grade Quiz and Continue</a></li>
</ul>
        </div>
<div id="progress" style="position:absolute; bottom:100;"></div>
</div>