<html>
   <head>
      <meta charset="utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1.0"></meta>
      <title>Neo4j GraphAcademy: Neo4j Administration</title>
      <link rel="stylesheet" type="text/css" href="https://neo4j.com/docs/developer-manual/current/docbook.css"></link>
      <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"></link>
      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css"></link>
      <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,400italic,600,300italic"></link>
      <link rel="stylesheet" type="text/css" href="https://neo4j.com/docs/developer-manual/current/css/extra.css"></link>
      <link rel="stylesheet" type="text/css" href="https://neo4j.com/docs/developer-manual/current/css/chunked-base.css"></link>
      <link rel="stylesheet" type="text/css" href="https://neo4j.com/docs/developer-manual/current/css/console.css"></link><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js" type="text/javascript"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" type="text/javascript"></script>
      <link rel="shortcut icon" href="https://neo4j.com/wp-content/themes/neo4jweb/favicon.ico"></link>
      <script type='text/javascript'
   src='https://neo4j.com/wp-content/themes/neo4jweb/assets/js/vendor/codemirror.min.js?ver=4.5.2'></script>
      <script type='text/javascript'>
        window.trainingPartName = "module-5";
      </script>
   </head>
   <body>
      <header style="top: 0px;">
         <a href="../part-0/" id="logo"><img src="https://neo4j.com/wp-content/themes/neo4jweb/assets/images/neo4j-logo-2015.png" alt="Neo4j Logo"></a>
         <ul class="documentation-library">
            <li id="menu-module-1">
              <a href="../part-1/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">1</strong>
              </span>
              Intro to Neo4j</a>
            </li>
            <li id="menu-module-2">
              <a href="../part-2/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">2</strong>
              </span>
              Overview Of Admin</a>
            </li>
            <li id="menu-module-3">
              <a href="../part-3/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">3</strong>
              </span>
              Managing a DB</a>
            </li>
            <li id="menu-module-4">
              <a href="../part-4/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">4</strong>
              </span>
              Causal Clustering</a>
            </li>
            <li id="menu-module-5">
              <a href="../part-5/" style="color: #000">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">5</strong>
              </span>
              Security</a>
            </li>
            <li id="menu-module-6">
              <a href="../part-6/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">6</strong>
              </span>
              Monitoring</a>
            </li>
            <li id="menu-module-7">
              <a href="../part-7/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">7</strong>
              </span>
              The End</a>
            </li>
         </ul>
         <nav id="header-nav">
         <span class="nav-previous">
           
              <a accesskey="p" href="../part-4/">
                <span class="fa fa-long-arrow-left" aria-hidden="true"></span>
              Clusters</a>
           
         </span>
         <span class="nav-current">
           <p class="nav-title" style="display: none;"></p>
         </span>
         <span class="nav-next">
           
              <a accesskey="n" href="../part-6/">Monitoring
                <span class="fa fa-long-arrow-right" aria-hidden="true"></span>
              </a>
           
         </span>
         </nav>
      </header>


<div id="developer-manual" style="padding-top: 150px; padding-left: 20px; padding-bottom: 100px;">
<h1>Security in Neo4j</h1>

      <div id="preamble columns medium-12">
<div class="sectionbody">
<script src="https://browser.sentry-cdn.com/4.4.1/bundle.min.js" crossorigin="anonymous"></script>
<script type='text/javascript'>
	var loc = window.location;
	document.write(unescape("%3Cscript src='https://munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script>
window.trainingClassName = 'neo4j-administration';
</script>

<script>Munchkin.init('773-GON-065');</script>


<style>
    @import "https://neo4j.com/online_training/cypher-gadget/libs/jquery.modal.min.css" screen;
    .modal {
        width: 775px;
        height: 775px;
        padding: 10px;
        margin: 0;
    }
    .blocker {
        height: initial;
        background-color: transparent;
    }
  a.button {
    display: block;
    text-align: center;
    width: 250px;
    font-size: 18px;
    margin-top: 50px;
    font-family: 'Open Sans';
    height: 55px;
    border-style: solid;
    border-width: 0;
    cursor: pointer;
    color: white;
    padding: 15px;
    font-weight: 300;
    background-color: #6dcc9c;
    border-color: #4ac084;
  }

  .button a hover {
      background-color: #4ac084;
  }

  pre.cypher-syntax {
    background-color: #eaf1f8;
  }
</style>
<script src="https://neo4j.com/online_training/cypher-gadget/libs/underscore.js"></script>
<script src="https://neo4j.com/online_training/cypher-gadget/libs/jquery.js"></script>
<script src="https://neo4j.com//online_training/cypher-gadget/libs/jquery-ui.min.js"></script>
<script src="https://neo4j.com/online_training/cypher-gadget/libs/jquery.modal.min.js"></script>
<script src="https://neo4jsandbox.com/js/js.cookie-2.1.3.min.js"></script>
<!--script src="/online_training/gadgetUtils.js"></script-->
<script type="text/javascript">
  Sentry.init({ dsn: 'https://652808557bb1478883636c96edb51739@sentry.io/1342352' });
</script>
<script src="https://neo4j.com/online_training/tasks.js"></script>
<script type="text/javascript">
function renderGadget(containerSelector, options) {
  if (!options.cypherSetup) return;
  var frameId = _.uniqueId("exmodal");
  $(containerSelector).append('<button onclick="setGadgetUrl(\'#' + frameId +
    '\')" rel="modal:open" class="btn">' + (options.label || 'Gadget') + '</button>');

    $(containerSelector).append(modalWindow(frameId,options));
  }

function modalWindow(frameId, options) {
   return `<div id="${frameId}" class="modal-dialog modal fade draggable" style="display:none;text-align:center;vertical-align:middle;" >
            <iframe data-src="/online_training/cypher-gadget/test.html?cypherSetup=${options.cypherSetup}&${formatTask(options)}" width="725" height="725" frameborder="0" style="margin:5px;"
              webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
           <div>`;
}
/*
    .modal {
        width: 775px;
        height: 675px;
        padding: 10px;
        margin: 0;
    }
*/

function formatTask(options) {
  if (options.task) return "cypherTaskJSON="+encodeURIComponent(JSON.stringify(options.task));
  if (options.taskName) return "cypherTask="+options.taskName;
  return "";
}


function setGadgetUrl(sel) {
  $(sel).modal();
  $(sel).draggable();
  var $iframe = $(sel).find("iframe");
  $iframe.attr("src", $iframe.data("src"));
}
</script>
</div>
</div>
<div  id="_about_this_module" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>About this module</h3>


<div class="paragraph">
<p>Now that you have gained experience managing a Neo4j instance and database , as well as managing Neo4j Causal Clusters, you will be introduced to how to secure a Neo4j application.</p>
</div>


<div class="paragraph">
<p>At the end of this module, you should be able to:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
Describe what security means for an application.
</li>
<li>
Configure a Neo4j instance to use LDAP as the authentication provider.
</li>
<li>
Describe how to secure data-in-transit.
</li>
<li>
Describe how to secure data-at-rest.
</li>
<li>
Configure and use security auditing.
</li>
</ul>
</div>
</div>
<div  id="_what_is_application_security" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>What is application security?</h3>


<div class="paragraph">
<p>Many applications today are distributed and provide services and data over the Internet. Users include customers, partners, and off-site employees. In this inter-connected world, security is a major concern. There are malicious actors who will attempt to access your application’s data, causing disruption and financial loss to your business. There are numerous ways that can be used to attack the data via the Internet, intranet, and even the 'human' back door.
Fixing a security breach may require significant updates to your application, especially if the application was not written or implemented to be secure. Deploying a newer version of your application means additional testing and possible down time, both costly to the enterprise.</p>
</div>


<div class="paragraph">
<p>In addition, your business may need to meet regulatory security requirements or security requirements promised in a customer contract. If it is discovered that your application does not meet these requirements, you could face fines or other serious consequences.</p>
</div>


<div class="paragraph">
<p>To secure your application, you need to be concerned about 3 things:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
Data security
</li>
<li>
Access control
</li>
<li>
User privacy
</li>
</ul>
</div>
<div  id="_data_security" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Data security</h3>


<div class="paragraph">
<p>Some information in an application is private must be protected. Exposing a customer’s private information could ruin the reputation of your enterprise, which could take years to recover from. Here are some examples of the types of private data your application needs to secure:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
Company financial data such as salaries, revenue, operating expenses, etc.
</li>
<li>
User pass-phrases for the application
</li>
<li>
Personal data such as names, credit card numbers, telephone numbers, social security numbers, etc.
</li>
<li>
Intellectual property such as code
</li>
</ul>
</div>
</div>
<div  id="_access_control" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Access control</h3>


<div class="paragraph">
<p>Controlling who accesses your application and what they have access to is very important to the business. You want to ensure that only valid users can use the application and malicious actors are kept out. In addition, you want to control which users can access specific application functionality and monitor what users do.</p>
</div>
</div>
<div  id="_user_privacy" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>User privacy</h3>


<div class="paragraph">
<p>Another concern in applications that extend to the Internet is user privacy. When a Web or mobile app requests data from your application, you need to ensure that only the required data is retrieved and sent to the app. That is, if the app requests personal information, such as a driver’s license ID, the data returned to the app contains only the ID for the user requested and not the IDs of multiple users that the app, then has to filter for display.</p>
</div>
</div>
<div  id="_securing_a_neo4j_application" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Securing a Neo4j application</h3>


<div class="paragraph">
<p>Neo4j applications consist of many parts, including databases, static files like images and document scans, application code, application servers and Web servers. These all need to be secured and you use different techniques and technologies to secure them.</p>
</div>


<div class="paragraph">
<p>There are many things you can do to make your Neo4j application secure. At the highest level, there are 2 areas you must address:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Building security into your Neo4j application.
</li>
<li>
Securing the deployed application and infrastructure.
</li>
</ol>
</div>
</div>
<div  id="_building_security_into_your_neo4j_application" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Building security into your Neo4j application</h3>


<div class="paragraph">
<p>The primary facets of building security into your Neo4j application include:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
Authentication — Is the user who they say they are?
</li>
<li>
Authorization — Is a user allowed to do what they are attempting to do?
</li>
<li>
Auditing – Create a record of who did what and when (so that you can monitor activity and investigate security breaches).
</li>
</ul>
</div>


<div class="paragraph">
<p>At a high level, the implementation of how your application performs authentication, authorization, and auditing can be configured by you as an administrator. However, there are aspects of security that may cross into application code. For example, there may be a specific procedure written that can only be executed by certain users. The procedure must be annotated and configured as such. In addition, code may be written to check roles at runtime for authorization.</p>
</div>
</div>
<div  id="_securing_the_deployed_application_and_infrastructure" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Securing the deployed application and infrastructure</h3>


<div class="paragraph">
<p>Securing a deployed Neo4j application and its infrastructure includes securing Neo4j instances and non-Neo4j server processes they communicate with, filesystems, networks, etc. This can include:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
Data-in-transit — securing data transmitted over the network.
</li>
<li>
Data-at-rest — securing private data in Neo4j database.
</li>
<li>
OS level resources — securing networks and filesystems.
</li>
<li>
Server processes — Neo4j instances, application servers, connectors, and Web servers.
</li>
<li>
Application-related files—securing application-related files outside of the database.
</li>
</ul>
</div>


<div class="paragraph">
<p>In this module, you will be introduced to how you as an administrator can secure those parts of the application related to Neo4j. This module will not cover tasks related to securing non-Neo4j resources, networks, and filesystems.</p>
</div>
</div>
</div>
<div  id="_neo4j_software_updates" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Neo4j software updates</h3>


<div class="paragraph">
<p>As an administrator, you must be aware of all software on your production systems and keep up-to-date with the software. In particular, you <span class="underline">must</span> ensure that the Neo4j version you are using has the the latest versions and patches, especially those that address security.</p>
</div>
</div>
<div  id="_authentication_in_neo4j" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Authentication in Neo4j</h3>


<div class="paragraph">
<p>There are three types of authentication frameworks supported by Neo4j:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
Native user authentication
</li>
<li>
Custom-built authentication
</li>
<li>
Single Point of Authentication (SPA)
</li>
</ul>
</div>


<div class="paragraph">
<p>Native user authentication means that users are created in the Neo4j database and authentication is performed based upon those values. Most enterprise applications do not use native user authentication in their deployed application.</p>
</div>


<div class="paragraph">
<p>Your application developers could write a custom authentication plugin. Although this is possible, the underlying internal procedures called by the custom authentication plugin could change in future releases of Neo4j so it is best to avoid this type of authentication for a deployed, secure application that will survive upgrades of Neo4j.</p>
</div>


<div class="paragraph">
<p>A SPA is highly recommended by Neo4j because it is easier to maintain and is more secure than an enterprise that uses multiple sources of user accounts.
Examples of a SPA are Lightweight Directory Access Protocol (LDAP), Active Directory (AD), and Kerberos which can be used for single sign-on.
The SPA is the only service in your enterprise that stores user names and passwords.
For training purposes, we will use an LDAP provider for authentication, but in your real application, you will need to configure Neo4j for whatever provider your application uses for user authentication.</p>
</div>


<div class="paragraph">
<p>You will use OpenLDAP for the hands-on Exercises of this module.</p>
</div>


<div class="paragraph">
<p>If you will be using a different LDAP or authentication provider in your real application, you should consult the <a href="https://neo4j.com/docs/operations-manual/3.5/authentication-authorization/">Neo4j Operations Manual</a>.</p>
</div>
<div  id="_enabling_authentication" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Enabling authentication</h3>


<div class="paragraph">
<p>A secure Neo4j instance should always have authentication enabled. By default, authentication is enabled for a Neo4j instance. You can explicitly set it in <strong>neo4j.conf</strong> as follows:</p>
</div>


<div class="paragraph">
<p><code>dbms.security.auth_enabled=true</code></p>
</div>
</div>
<div  id="_how_roles_are_used_for_users" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>How roles are used for users</h3>


<div class="paragraph">
<p>Even though roles are not required for authentication, they are for authorization to access Neo4j. Roles must be built into the configuration of a SPA, for example LDAP. Roles are used at runtime to authorize how the current user can access Neo4j resources (data or procedures).</p>
</div>


<div class="paragraph">
<p>Refer to this table in the <a href="https://neo4j.com/docs/operations-manual/3.5/authentication-authorization/native-user-role-management/native-roles/">Neo4j Operations Manual</a> that describes Neo4j native roles. One of these pre-defined, native roles must be associated with any user that will be connecting to the Neo4j instance for general access. So for example, the user with the role of <em>reader</em> will only have read access to the database while a user with the role of <em>publisher</em> will be able to create data in the database.</p>
</div>


<div class="paragraph">
<p>In addition, you can define custom roles that are application-specific and used together with specific custom procedures.</p>
</div>
</div>
<div  id="_using_ldap_for_authentication_and_authorization" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Using LDAP for authentication and authorization</h3>


<div class="paragraph">
<p>There are many LDAP providers an enterprise can use including Active Directory and Open LDAP.</p>
</div>


<div class="paragraph">
<p>The tasks for using LDAP for authentication with Neo4j include:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Add role information to LDAP (groups).
</li>
<li>
Configure Neo4j for LDAP authentication.
</li>
<li>
Test.
</li>
</ol>
</div>
<div  id="_adding_groups_for_roles_in_ldap" class="sect3 "  >
<h4>Adding groups for roles in LDAP</h4>


<div class="paragraph">
<p>In your enterprise, you will need to work with the system administrator responsible for maintaining the user directory (LDAP). Part of the configuration that <span class="underline">must</span> be modified for LDAP is the addition of groups for users. The groups added to LDAP and associated with specific users correspond to roles in Neo4j. An easy way to identify a group in LDAP is with a group ID.</p>
</div>


<div class="paragraph">
<p>For example, the LDAP would have these entries that correspond to the Neo4j native <em>reader</em> and <em>publisher</em> roles for the training <strong>neo4jtraining.com</strong> domain. The attribute that is used to identify the groups is <em>gidnumber</em>.</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre># reader group
dn: cn=reader,ou=groups,dc=neo4jtraining,dc=com
objectClass: posixGroup
objectClass: top
cn: reader
gidnumber: 501

# publisher group
dn: cn=publisher,ou=groups,dc=neo4jtraining,dc=com
objectClass: posixGroup
objectClass: top
cn: publisher
gidnumber: 502</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>In addition, each user that will be authenticated for connecting to the Neo4j instance, will need to be modified in the LDAP to be associated with a specific group. Here is are examples of the <em>reader</em> and <em>publisher</em> users that you will be working with in this training:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre># user reader
objectClass: organizationalPerson
objectClass: person
objectClass: extensibleObject
objectClass: uidObject
objectClass: inetOrgPerson
objectClass: posixAccount
objectClass: top
cn: Reader User
givenName: Reader
sn: reader
uid: reader
gidnumber: 501
uidNumber: 1000
homedirectory: /home/users/reader
mail: reader@neo4jtraining.com
ou: users
userpassword: reader

# user publisher
dn: uid=publisher,ou=users,dc=neo4jtraining,dc=com
objectClass: organizationalPerson
objectClass: person
objectClass: extensibleObject
objectClass: uidObject
objectClass: inetOrgPerson
objectClass: posixAccount
objectClass: top
cn: Publisher User
givenName: Publisher
sn: publisher
uid: publisher
gidnumber: 502
uidNumber: 1001
homedirectory: /home/users/publisher
mail: publisher@neo4jtraining.com
ou: users
userpassword: publisher</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>There are many ways to configure groups and users in LDAP. This is just an example of how the LDAP is configured that you will be working with in this training.  Notice that each group has an ID, <em>gidnumber</em> and each user has an ID, <em>uidNumber</em>. The group ID is used to map to roles in Neo4j.</p>
</div>


<div class="paragraph">
<p>Note that if a user does not specify a group ID, it must specify an attribute <em>memberOf</em> that is set to  the designated name, <em>dn</em> of the group.</p>
</div>
</div>
<div  id="_querying_the_ldap_server" class="sect3 "  >
<h4>Querying the LDAP Server</h4>


<div class="paragraph">
<p>The Neo4j instance never writes to the LDAP Server. Before you begin configuring the Neo4j instance to use LDAP, you should confirm that the LDAP Server is properly configured for use with Neo4j. You query the LDAP Server by using the <code>ldapsearch</code> utility from the ldap-utils library that is available on OS X and Linux, and by <code>ldp.exe</code> on Windows.</p>
</div>


<div class="paragraph">
<p>To understand the groups that users are associated with in the LDAP, you should perform this type of query:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>ldapsearch -x -v  -W -D '&lt;designated-name-for-user&gt;'
                     -H &lt;ldap-server&gt;:&lt;port&gt;
                     -b '&lt;search-base&gt;'
                     "&lt;filter-for-user&gt;"</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is an example for retrieving the user <em>architect</em> in the training LDAP Server:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>ldapsearch -x -v  -W -D 'uid=architect,ou=users,dc=neo4jtraining,dc=com'
           -H ldap://openldap-training.neo4jlabs.com:389
           -b 'dc=neo4jtraining,dc=com'
           "(&amp;(objectClass=*)(sn=architect))"</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result of executing this <code>ldapsearch</code> command. When you execute this type of search, you must provide the password for the user which in this LDAP is <em>architect</em>.</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/ldapsearch-architect1.png" alt="ldapsearch-architect1" width="800">
</p>
</div>


<div class="paragraph">
<p>In this example, you see that this particular user is part of many object classes. In a large user directory, you should provide a more specific filter to improve the search.</p>
</div>


<div class="paragraph">
<p>For example, a user directory will contain entries for non-users such as printers. If you want to focus the search only on people, you would specify something like the following to filter by <em>person</em>:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>ldapsearch -x -v  -W -D 'uid=architect,ou=users,dc=neo4jtraining,dc=com'
           -H ldap://openldap-training.neo4jlabs.com:389
           -b 'dc=neo4jtraining,dc=com'
           "(&amp;(objectClass=person)(sn=architect))"</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>For integration with Neo4j, you must examine the LDAP entries to understand what groups are defined as they will need to be mapped to Neo4j native roles and possibly custom roles. In the previous image, you saw that the <em>gidNumber</em> attribute is assigned a value of 503. In LDAP, a user can be a member of more than one group.</p>
</div>


<div class="paragraph">
<p>For example, once you determine the attribute that is used to define group membership in the LDAP, you can perform a query to retrieve all entries that use that same <em>gidNumber</em> of <em>503</em>:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>ldapsearch -x -H ldap://openldap-training.neo4jlabs.com:389  -b 'dc=neo4jtraining,dc=com' '(gidNumber=503)'</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>And here we see an entry for a user and an entry for a group.</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/ldapsearch-architect2.png" alt="ldapsearch-architect2" width="800">
</p>
</div>


<div class="paragraph">
<p>Notice that the group entry has an <em>objectClass</em> of <em>posixGroup</em>. This tells you that all groups are defined with this attribute in this particular LDAP.</p>
</div>


<div class="paragraph">
<p>So, for example, you can then do a query to find all entries that have this attribute to learn about which groups are defined in the LDAP:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>ldapsearch -x -H ldap://openldap-training.neo4jlabs.com:389  -b 'dc=neo4jtraining,dc=com' '(objectClass=posixGroup)'</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/ldapsearch-architect3.png" alt="ldapsearch-architect3" width="800">
</p>
</div>


<div class="paragraph">
<p>What queries you perform on your LDAP provider will depend on the discovery of entries in the LDAP.</p>
</div>
</div>
<div  id="_exercise_1_exploring_the_training_user_directory" class="sect3 "  >
<h4><strong>Exercise #1: Exploring the training User Directory</strong></h4>


<div class="paragraph">
<p>In this Exercise, you will simply execute a couple of commands to retrieve data from an existing LDAP server that will be used for the Exercises of this training.</p>
</div>


<div class="paragraph">
<p><strong>Before you begin:</strong></p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Open a terminal window on your system where you have worked with a stand-alone Neo4j instance in the <em>Managing a Neo4j Database</em> module.
</li>
<li>
Ensure that you have the LDAP utilities package installed on your system. (For example on Debian: <code>sudo apt-get install ldap-utils</code>).
</li>
</ol>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>


<div class="paragraph">
<p>In this example, and for the LDAP provider (an EC2 instance) you will be using for the Exercises in this module, the users are all part of the <strong>neo4jtraining.com</strong> domain.</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Execute this <code>ldapsearch</code> command to retrieve all entries from the LDAP Server:
</li>
</ol>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>ldapsearch -x -H ldap://openldap-training.neo4jlabs.com:389  -b 'dc=neo4jtraining,dc=com' '(objectclass=*)'</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L05-Ex1-ldapsearch1.png" alt="L05-Ex1-ldapsearch1" width="800">
</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
In an enterprise LDAP, you will probably not want to perform this type of query as it will return too much information, but in our training environment, you can perform this type of query to understand want is defined in our training LDAP Server.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="2">
<li>
Execute this <code>ldapsearch</code> command to retrieve the <em>reader</em> entry from the LDAP Server. When prompted for the password, enter <em>reader</em>.
</li>
</ol>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>ldapsearch -x -v  -W -D 'uid=reader,ou=users,dc=neo4jtraining,dc=com' -H ldap://openldap-training.neo4jlabs.com:389  -b 'dc=neo4jtraining,dc=com' "(&amp;(objectClass=*)(cn=reader))" memberOf</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L05-Ex1-ldapsearch2.png" alt="L05-Ex1-ldapsearch2" width="800">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="3">
<li>
Execute the search for another user in the LDAP, for example <em>publisher</em>.
</li>
<li>
Execute the search for returning all group entries in the LDAP.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L05-Ex1-ldapsearch3.png" alt="L05-Ex1-ldapsearch3" width="800">
</p>
</div>


<div class="paragraph">
<p>You have now confirmed that you can access the LDAP Server that will be used for authentication with the Neo4j instance and you have explored the entries in the LDAP.</p>
</div>
</div>
<div  id="_configuring_neo4j_for_ldap_authentication_and_authorization" class="sect3 "  >
<h4>Configuring Neo4j for LDAP authentication and authorization</h4>


<div class="paragraph">
<p>There are many configuration settings related to authentication and authorization in the <strong>neo4j.conf</strong> file. The <a href="https://neo4j.com/docs/operations-manual/3.5/authentication-authorization/ldap-integration/">Neo4j Operations Manual</a> describes how you can configure Neo4j to connect to and use an LDAP provider.</p>
</div>


<div class="paragraph">
<p>You can configure Neo4j to work with:</p>
</div>
<div class="ulist">
<ul>
<li>
Active Directory
</li>
<li>
Active Directory using a sAMAccountName
</li>
<li>
openLDAP
</li>
</ul>
</div>


<div class="paragraph">
<p>Each of these LDAP providers require different settings for authentication. For example using <em>AD</em> and <em>openLDAP</em>, you specify a value for <em>dbms.security.ldap.authentication.user_dn_template</em> and for <em>AD</em> with <em>sAMAccountName</em>, you specify values for other properties.</p>
</div>


<div class="paragraph">
<p>Using <em>AD</em> with <em>SAMAccountName</em> gives you the greatest flexibility because with this configuration, you do not need to specify a fixed <em>dn</em> template for authentication. Most enterprise deployments use this option.</p>
</div>


<div class="paragraph">
<p>There are several properties you specify for authorization and how you set these properties will depend on your LDAP provider.</p>
</div>


<div class="paragraph">
<p>In summary, there are three options for authorization with LDAP to establish the user&#8217;s group membership:</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Settings</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock"><em>use_system_account = false</em></p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">The user will search their own group membership during authentication.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock"><em>use_system_account = true</em></p>
<p class="tableblock"><em>use_samaccountname=false</em></p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">The system account will log in and search for the users group membership.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock"><em>use_system_account = true</em></p>
<p class="tableblock"><em>use_samaccountname=true</em></p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">The system account will log in and search for the user based upon their <em>samaccountname</em> and will do both group membership as well as return the users <em>dn</em> so that bind (authentication) can be completed for the user.</p></td>
</tr>
</tbody>
</table>


<div class="paragraph">
<p></p>
</div>


<div class="paragraph">
<p>For <em>openLDAP</em>, you set up a stand-alone or core and read replica servers in a cluster for authentication using an LDAP Server, you configure the following:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>dbms.security.auth_enabled=true
dbms.security.auth_provider=ldap
#---
dbms.security.ldap.host=&lt;host IP address where LDAP Server runs&gt;
#---
dbms.security.ldap.authentication.mechanism=simple
dbms.security.ldap.authentication.user_dn_template=uid={0},&lt;top-level entity for users&gt;
#---
dbms.security.ldap.authorization.use_system_account=false
dbms.security.ldap.authorization.user_search_base=&lt;top-level entity for users&gt;
dbms.security.ldap.authorization.user_search_filter=(&amp;(objectClass=*)(uid={0}))
dbms.security.ldap.authorization.group_membership_attributes=&lt;attribute-used-to-define-groups-or-members&gt;
dbms.security.ldap.authorization.group_to_role_mapping=\
    &lt;group-or-member &gt;  = reader; \
    &lt;group-or-member &gt;  = publisher; \
    &lt;group-or-member &gt;  = architect; \
    &lt;group-or-member &gt;  = admin; \
    &lt;group-or-member &gt; = &lt;custom-role&gt;</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>For example, with the LDAP Server that you will be using in this training, you  specify:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>dbms.security.auth_enabled=true
dbms.security.auth_provider=ldap
#---
#LDAP Server running as EC2 instance
dbms.security.ldap.host=openldap-training.neo4jlabs.com
#---
dbms.security.ldap.authentication.mechanism=simple
# users are defined under ou=users,dc=neo4jtraining,dc=com in LDAP
dbms.security.ldap.authentication.user_dn_template=uid={0},ou=users,dc=neo4jtraining,dc=com
#---
dbms.security.ldap.authorization.use_system_account=false
# limit where the search starts so entire LDAP is not searched
dbms.security.ldap.authorization.user_search_base=ou=users,dc=neo4jtraining,dc=com
# limit the entries that are searched to be people
dbms.security.ldap.authorization.user_search_filter=(&amp;(objectClass=person)(uid={0}))
# in this LDAP the gidnumber attribute is used to define groups
dbms.security.ldap.authorization.group_membership_attributes=gidnumber
# each group is mapped to a Neo4j native role and to the custom accounting role
dbms.security.ldap.authorization.group_to_role_mapping=\
    501  = reader; \
    502  = publisher; \
    503  = architect; \
    504  = admin; \
    505 = accounting</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
Just as the LDAP can be configured to allow users to be members of multiple groups. You can also specify multiple groups to be mapped to the same role.
</td>
</tr>
</table>
</div>


<div class="paragraph">
<p>After you have made these configuration changes for the Neo4j instance, you restart the instance and then test that users in the LDAP can access the Neo4j instance.</p>
</div>


<div class="paragraph">
<p>The <strong>security.log</strong> file contains log records of all users that connected to or attempted to connect to the Neo4j instance. Later in this training, you will learn more about monitoring and logging. If you need to troubleshoot an authentication issue, you can set <em>dbms.log.security.level=DEBUG</em> in your Neo4j configuration to see more information about the login attempts. In most cases the troubleshooting will need to occur on the LDAP Server side to better understand the requests received from the Neo4j instance.</p>
</div>
</div>
<div  id="_multiple_authentication_providers" class="sect3 "  >
<h4>Multiple authentication providers</h4>


<div class="paragraph">
<p>It is possible to use native and another authentication provider together in situations where a small number of users would be maintaining the database, but most of the users would use the enterprise authentication provider such as LDAP. To to this, your configuration setting would be:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>dbms.security.auth_providers=native,ldap</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->
</div>
<div  id="_turn_off_role_mapping_temporary" class="sect3 "  >
<h4>Turn off role mapping (temporary)</h4>


<div class="paragraph">
<p>In a troubleshooting situation, you may need to give all users access to the database. You can start the Neo4j instance where all role mapping is bypassed. In this example, all groups with the ID of user would have the reader role:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>dbms.security.ldap.authorization.group_membership_attributes=objectClass
dbms.security.ldap.authorization.group_to_role_mapping="user" = reader</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>In the next Exercise, you will configure a Neo4j instance to use authentication with the LDAP Server you accessed in the previous exercise.</p>
</div>
</div>
<div  id="_exercise_2_configuring_authentication_for_a_stand_alone_instance" class="sect3 "  >
<h4><strong>Exercise #2: Configuring authentication for a stand-alone instance</strong></h4>


<div class="paragraph">
<p>In this Exercise, you will modify the configuration for the stand-alone Neo4j instance that you have worked with in the <em>Managing a Neo4j Database</em> module, prior to using Docker for Causal Clustering. You will use the <strong>movies3.db</strong> that you worked with previously with the Neo4j stand-alone instance.  Then you will test that the authentication is working.</p>
</div>


<div class="paragraph">
<p><strong>Before you begin</strong></p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Make sure you have completed Exercise 1 that confirms that you can access the LDAP Server.
</li>
<li>
Modify <strong>neo4j.conf</strong> to use <strong>movie3.db</strong> as the active database.
</li>
<li>
Start or restart the Neo4j instance and confirm that it starts without error.
</li>
<li>
Open a terminal window on your system where you have worked with a stand-alone Neo4j instance using the <strong>movie3.db</strong> database.
</li>
<li>
Stop the Neo4j instance.
</li>
</ol>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Make a copy of <strong>neo4j.conf</strong>, which is the last good configuration for this Neo4j instance.
</li>
<li>
Modify the properties in this file to use the training LDAP Server as the LDAP provider (openldap-training.neo4jlabs.com). You can set the properties in their locations in the <strong>neo4j.conf</strong> file, but a useful way to work is to add the properties you are setting to the end of the file so you can see all of your modifications in one place.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L05-Ex2-configureAuth.png" alt="L05-Ex2-configureAuth" width="800">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="3">
<li>
Start the Neo4j instance.
</li>
<li>
Examine the log file to ensure that the instance started without errors. If it does not start, review/adjust the properties you set in <strong>neo4j.conf</strong>.
</li>
<li>
Start cypher-shell specifying the user <em>reader/reader</em>. Can you log in?
</li>
<li>
Enter a Cypher statement that reads from the database <code>MATCH (n) RETURN count(n);</code>
</li>
<li>
Enter a Cypher statement that writes to the database <code>CREATE (p:Person {name:'John'}) RETURN p.name;</code> Did you see an error? This is because a user with the <em>reader</em> role cannot modify the database.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L05-Ex2-reader.png" alt="L05-Ex2-reader" width="800">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="8">
<li>
Exit out of cypher-shell.
</li>
<li>
Start cypher-shell specifying the user <em>publisher/publisher</em>. Can you log in?
</li>
<li>
Enter a Cypher statement that reads from the database <code>MATCH (n) RETURN count(n);</code>
</li>
<li>
Enter a Cypher statement that writes to the database <code>CREATE (p:Person {name:'John'}) RETURN p.name;</code>
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L05-Ex2-publisher.png" alt="L05-Ex2-publisher" width="800">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="12">
<li>
Look at the log records in the <strong>security.log</strong> file. Do they correspond to your activities against the Neo4j instance?
</li>
</ol>
</div>


<div class="paragraph">
<p>Using LDAP for authentication, you can control which users have different types of access to the database based upon the groups defined in the LDAP. If you need to perform administrative operations against the database, you would log in as <em>admin/admin</em> which is what currently is defined for this LDAP Server used for training.</p>
</div>


<div class="paragraph">
<p><strong>Exercise 2: Taking if further</strong>:</p>
</div>


<div class="paragraph">
<p>Configure and test the core and read replica servers you used for Causal Clustering in the previous module for authentication using the same LDAP Server.</p>
</div>
</div>
<div  id="_ldap_caching" class="sect3 "  >
<h4>LDAP caching</h4>


<div class="paragraph">
<p>By default, the Neo4j instance caches security-related interactions between a client and the LDAP Server as an optimization. A best practice is to leave this setting. If you set it to false, the client experience slower as the authentication/authorization needs to be done with every request to the Neo4j instance. See the documentation about the <em>dbms.security.ldap.authentication.cache_enabled</em> settings and how to clear the Auth cache.</p>
</div>
</div>
<div  id="_using_secure_ldap" class="sect3 "  >
<h4>Using secure LDAP</h4>


<div class="paragraph">
<p>If the LDAP provider uses encryption (LDAPS or StartTLS=true), then you must set some additional properties in <strong>neo4j.confg</strong> to specify that encryption will be used and what port to use. In addition, the LDAP Server Certificate needs to be added to the JVM keystore for each Neo4j instance:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>keytool -import -alias &lt;alias-name&gt; -keystore ..\lib\security\cacerts -file &lt;path-to-cert-file&gt;</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>This is commonly used with Active Directory. See the documentation about encrypting with your particular authentication provider.</p>
</div>


<div class="paragraph">
<p>All production environments should use an SSL certificate issued by a Certificate Authority when accessing their LDAP provider. You will work with the system administrator responsible for providing the certificate. You can, however, set up and configure a self-signed test certificate while you are setting up your Neo4j Instance to use the LDAP provider. To do this you specify a value for <em>dbms.jvm.additional</em> in <strong>neo4j.conf</strong> as specified in the documentation. Once all of your tests are complete, you can switch to the real SSL certificate issued by the Certificate Authority for the LDAP Server.</p>
</div>
</div>
</div>
</div>
<div  id="_securing_data_in_transit" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Securing data-in-transit</h3>


<div class="paragraph">
<p>Users “in the building”, such as employees can access the application from an internal network. These networks are secure.  In addition, “off site” employees typically access the application using a Virtual Private Network (VPN) which is also secure. Customers or other users who access the application over the Internet, by default, do not use a secure connection. If these customers send private data like pass-phrases and credit card numbers, it can be examined, stolen, or altered by a malicious actor somewhere on the Internet. To secure their connection, you must provide SSL/TLS access your application. SSL/TLS is a software layer that encrypts data sent and received over the Internet.</p>
</div>
<div  id="_how_to_secure_data_in_transit" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>How to secure data-in-transit</h3>


<div class="paragraph">
<p>If your application has users that access the application over the Internet, you should implement SSL/TLS by doing the following.</p>
</div>
<div class="ulist">
<ul>
<li>
Identify which server processes are accessed by users over the Internet.
</li>
<li>
Identify server ports that will be used for these server processes.
</li>
<li>
Configure each server process to use SSL ports.
</li>
<li>
Create and publish secure digital certificates for each server process.
</li>
</ul>
</div>


<div class="paragraph">
<p>A digital certificate is used by client applications when they communicate with the server processes using SSL/TLS. A digital certificate must have an expiration date.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
You must ensure that the version of SSL/TLS software your application uses is up-to-date and that it supports all the types of clients that will be accessing your application. For example, not all browsers are compatible with the latest SSL/TLS versions.
</td>
</tr>
</table>
</div>
<div  id="_recommendations_for_external_users_using_your_application_over_the_internet" class="sect3 "  >
<h4>Recommendations for external users using your application over the Internet</h4>


<div class="paragraph">
<p>You should recommend that external users store the following artifacts securely:</p>
</div>
<div class="ulist">
<ul>
<li>
Digital certificates
</li>
<li>
User credentials (encrypt if they are included in code or a configuration file; never use clear-text credentials)
</li>
</ul>
</div>
</div>
</div>
<div  id="_configuring_the_neo4j_instance_for_ssltls" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Configuring the Neo4j instance for SSL/TLS</h3>


<div class="paragraph">
<p>Because the use of certificates is secure and requires a domain that you own as well as certificates from a trusted Certificate Authority (CA), you will learn how to configure a Neo4j instance, but will not perform the steps in your training environment. The creation of certificates and keys should be used in your real production environment.</p>
</div>


<div class="paragraph">
<p>Here are the steps you should take for your production system.</p>
</div>


<div class="paragraph">
<p><strong>Step 1: Install JCE</strong></p>
</div>


<div class="paragraph">
<p>To use SSL/TLS with the Neo4j instance, you must first ensure that the <a href="https://www.oracle.com/technetwork/java/javase/downloads/jce8-download-2133166.html">Java Cryptography Extension (JCE)</a> is installed on the host machine.</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Download the JCE zip file from the above location or from <a href="https://s3-us-west-1.amazonaws.com/data.neo4j.com/admin-neo4j/jce_policy-8.zip">here</a>
</li>
<li>
Unzip the file to create <strong>local_policy.jar</strong> and <strong>US_export_policy.jar</strong>.
</li>
<li>
Navigate to the Java 8 <strong>jre/lib/security/policy/unlimited</strong> folder.
</li>
<li>
Save a copy of the existing files.
</li>
<li>
Copy the two <strong>.jar</strong> files you unzipped into this <strong>unlimited</strong> folder.
</li>
</ol>
</div>


<div class="paragraph">
<p>Your Neo4j instance can only provide SSL if you have installed JCE. On Linux/Debian, you can confirm that your specific ports of the running Neo4j instance are SSL-capable by executing one of the following commands:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre># a causal cluster raft listen address
nmap --script ssl-enum-ciphers -p 7000 localhost
# for HTTPS
nmap --script ssl-enum-ciphers -p 7473 localhost</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Suppose we have installed JCE for use with our Neo4j instance. Here is an example where we see that the HTTPS port uses these ciphers and the HTTP port does not:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/nmap.png" alt="nmap" width="800">
</p>
</div>


<div class="paragraph">
<p><strong>Step 2: Obtain certificates</strong></p>
</div>


<div class="paragraph">
<p>Determine how many security policies you will use. For example, you may have policies for clients, backups, and cluster communications. Each policy will have its own private key (<strong>private.key</strong>) and public certificate (<strong>public.crt</strong>). You must obtain the certificates from a trusted Certificate Authority in PEM format. If your application requires multiple certificates, they can be combined into a single file.</p>
</div>


<div class="paragraph">
<p>To obtain a certificate you must first have a domain name that you own. You can buy a fixed domain name or you can buy a more flexible one from a site such as <a href="https://dyn.com/">dyn.com</a>. There are many providers of certificates you can use. Here is an <a href="https://medium.com/neo4j/getting-certificates-for-neo4j-with-letsencrypt-a8d05c415bbd">article</a> that explains how to use LetsEncrypt which works well with Neo4j instances.</p>
</div>


<div class="paragraph">
<p><strong>Step 3: Create folders for the security policies</strong></p>
</div>


<div class="paragraph">
<p>The default location for certificates is defined in <strong>neo4j.conf</strong> with the <em>dbms.directories.certificates</em> property.</p>
</div>


<div class="paragraph">
<p>In this location, create a folder for each security policy your application requires, for example <strong>client_policy</strong>, <strong>backup_policy</strong>, <strong>cluster_policy</strong>. Then, in each of these folders, create the <strong>revoked</strong> and <strong>trusted</strong> sub-folders.</p>
</div>


<div class="paragraph">
<p><strong>Step 4: Place keys and certificates into your Neo4j installation</strong></p>
</div>


<div class="paragraph">
<p>Place the <strong>.key</strong> and <strong>.cert</strong> files in the top-level folder for the security policy. Place a copy of the <strong>.cert</strong> file in the <strong>trusted</strong> folder for the security policy.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
If you are using <em>LetsEncrypt</em>, follow the instructions in the article regarding links to the certificates and keys rather than copying them.
</td>
</tr>
</table>
</div>


<div class="paragraph">
<p><strong>Step 5: Configure SSL for the Neo4j instance</strong></p>
</div>


<div class="paragraph">
<p>Here is an example of recommended settings to configure SSL for a Neo4j instance that will support SSL for all clients:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre># client policy
dbms.ssl.policy.client_policy.base_directory=/var/lib/neo4j/certificates/client_policy
dbms.ssl.policy.client_policy.private_key=/var/lib/neo4j/certificates/client_policy/private.key
dbms.ssl.policy.client_policy.public_certificate=/var/lib/neo4j/certificates/client_policy/public.cert
dbms.ssl.policy.client_policy.client_auth=REQUIRE
bolt.ssl_policy=client_policy
https.ssl_policy=client_policy

#all bolt communication must be encrypted
dbms_connector_bolt_tls_level=REQUIRED

#prevent use of http port
dbms.connector.http.listen_address=127.0.0.1:7687

# Web access only using HTTPS for Neo4j Browser
dbms.security.http_strict_transport_security=Strict-TransportSecurity: max-age=31536000; includeSubDomains</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>The directory <strong>client_policy</strong> is where the certificate and key is available to the Neo4j instance. All bolt communication must use <em>tls_level</em>, which ensures that all credentials used for authentication and clear-text data are encrypted. You cannot disable the HTTP port, but you can configure it to loop back to this server. Additionally, we ensure that all Web access for the Neo4j Browser must be via HTTPS.</p>
</div>
</div>
<div  id="_ssl_for_causal_clusters" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>SSL for Causal Clusters</h3>


<div class="paragraph">
<p>For each Neo4j instance that will serve as a core server or read replica, you should configure SSL as you do for a stand-alone Neo4j instance. You must configure a separate policy for the cluster, for example <em>cluster_policy</em>. Each server will use both the <em>client_policy</em> and the <em>cluster_policy</em>.</p>
</div>


<div class="paragraph">
<p>Here is an example of the SSL configuration for a member of a cluster that you add to the Neo4j configuration in addition to the SSL configuration settings you saw earlier for the client policy:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre># cluster policy
dbms.ssl.policy.cluster_policy.base_directory=/var/lib/neo4j/certificates/cluster_policy
dbms.ssl.policy.cluster_policy.private_key=/var/lib/neo4j/certificates/cluster_policy/private.key
dbms.ssl.policy.cluster_policy.public_certificate=/var/lib/neo4j/certificates/cluster_policy/public.cert
dbms.ssl.policy.cluster_policy.client_auth=REQUIRE

# specify TLS version
dbms.ssl.policy.cluster_policy.tls_version=TLSv1.2

# specify ciphers used
dbms.ssl.policy.cluster_policy.ciphers=TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384

causal_clustering.ssl_policy=cluster_policy

# use a specfic backup policy for the cluster
dbms.backup.ssl_policy=backup_policy</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->
</div>
<div  id="_ssl_for_backups" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>SSL for backups</h3>


<div class="paragraph">
<p>Whether you are using Neo4j stand-alone or in a cluster, a best practice is to also ensure that SSL is used for backups. To do so, you can create and configure a policy, for example <em>backup_policy</em>, for backups that also requires a certificate.</p>
</div>
</div>
<div  id="_additional_settings_related_to_data_in_transit" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Additional settings related to data-in-transit</h3>


<div class="paragraph">
<p>Here are some additional settings that you should consider to help reduce unintended access to your Neo4j instances:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>#prevent browser from caching logging information
browser.retain_connection_credentials=false

#prevent browser staying open
browser.credential_timeout=15m

# Using a specific CORS response header
dbms.connectors.access_control_allow_origin=neo4j.com

# disable data usage collection by third parties
dbms.udc.enabled=false</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->
</div>
<div  id="_best_practices_for_developers" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Best practices for developers</h3>


<div class="paragraph">
<p>You should work with your security administrator to come up with a set of guidelines for developers of your application to ensure that data-in-transit is secure. For example, developers should never include private data in a Cypher statement, but use parameters to avoid Cypher injections at runtime.</p>
</div>
</div>
</div>
<div  id="_securing_data_at_rest" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Securing data-at-rest</h3>


<div class="paragraph">
<p>Securing data-at-rest means securing private data in a Neo4j installation including databases and backups.</p>
</div>


<div class="paragraph">
<p>An enterprise database typically contains private customer, personal, and financial data. If you do not secure the private data in the database, a malicious actor could access or steal the database and the private data would be exposed.</p>
</div>
<div  id="_securing_files_at_the_os_level" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Securing files at the OS level</h3>


<div class="paragraph">
<p>OS-level security restricts access to application files such as:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
Database files
</li>
<li>
Application-related files outside the database
</li>
<li>
Configuration files for the Neo4j instance
</li>
<li>
Neo4j executables
</li>
<li>
Application executables and libraries
</li>
<li>
Security-related files (keys, digital certificates)
</li>
</ul>
</div>


<div class="paragraph">
<p>The system administrator is responsible for setting the access permissions for all files stored in the filesystem. If a malicious actor can access a directory in a filesystem that contains application files, they can steal, modify, or delete files in that directory. In addition, if the files in that directory contain private information, this information could be exposed.</p>
</div>
</div>
<div  id="_ensure_that_neo4j_does_not_run_as_root" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Ensure that Neo4j does not run as root</h3>


<div class="paragraph">
<p>Using a non-privileged, dedicated service account restricts the database from accessing the
critical areas of the operating system that are not required by the Neo4j instance. This will
also mitigate the potential for unauthorized access via a compromised, privileged account
on the operating system.</p>
</div>


<div class="paragraph">
<p>You can determine which processes are owned by <em>neo4j</em> using: <code>ps -ef |grep -E “neo4j”</code></p>
</div>


<div class="paragraph">
<p>By default the user, <em>neo4j</em> owns the processes running that are related to the Neo4j instance.</p>
</div>


<div class="paragraph">
<p>The following directories should be read-only:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
<strong>conf</strong>
</li>
<li>
<strong>import</strong>
</li>
<li>
<strong>bin</strong>
</li>
<li>
<strong>lib</strong>
</li>
<li>
<strong>plugins</strong>
</li>
</ul>
</div>


<div class="paragraph">
<p>The following directories should be read/write:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
<strong>data</strong>
</li>
<li>
<strong>logs</strong>
</li>
<li>
<strong>metrics</strong>
</li>
</ul>
</div>


<div class="paragraph">
<p>And the <strong>bin</strong> directory should be execute.</p>
</div>


<div class="paragraph">
<p>You should also set the log files to only be writable by <em>neo4j</em> and readable by <em>root</em>.</p>
</div>
</div>
</div>
<div  id="_security_auditing" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Security auditing</h3>


<div class="paragraph">
<p>You must have a plan for analyzing a suspected security breach so you can respond quickly and effectively. As part of that plan, you should implement a security audit trail that captures which users logged in successfully and those that failed.</p>
</div>


<div class="paragraph">
<p>Implementing an audit trail does not secure your application against malicious actors, but the information that is captured can be used to alert you of a potential security breach or to aid in the investigation of a suspected security breach.</p>
</div>


<div class="paragraph">
<p>Here are some recommended settings for security auditing in Neo4j:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>dbms.directories.logs=logs
# Log level for the security log. One of DEBUG, INFO, WARN and ERROR.
dbms.logs.security.level=INFO
# Threshold for rotation of the security log.
dbms.logs.security.rotation.size=20m
# Minimum time interval after last rotation of the security log before
it may be rotated again.
dbms.logs.security.rotation.delay=300s
# Maximum number of history files for the security log.
dbms.logs.security.rotation.keep_number=7</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>In a troubleshooting situation or if you want to more closely monitor access, you would set the level to <em>DEBUG</em>.</p>
</div>
<div  id="_exercise_3_security_auditing" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise #3: Security auditing</strong></h3>


<div class="paragraph">
<p>In this Exercise, you will modify the security auditing configuration for the stand-alone Neo4j instance that you have worked earlier in this module.</p>
</div>


<div class="paragraph">
<p><strong>Before you begin</strong></p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Make sure you have completed Exercise 2 where you have configured and tested the Neo4j instance to use the training LDAP Server.
</li>
<li>
Open a terminal window on your system.
</li>
<li>
Stop the Neo4j instance.
</li>
</ol>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Make a copy of <strong>neo4j.conf</strong>, which is the last good configuration for this Neo4j instance.
</li>
<li>
Modify the property in this file log security events at the INFO level.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L05-Ex3-configure1.png" alt="L05-Ex3-configure1" width="800">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="3">
<li>
Start the Neo4j instance.
</li>
<li>
Examine the log file to ensure that the instance started without errors. If it does not start, review/adjust the properties you set in <strong>neo4j.conf</strong>.
</li>
<li>
Start cypher-shell specifying the user <em>reader/reader</em>.
</li>
<li>
Exit out of cypher-shell and log in again specifying <em>accounting/accounting</em>.
</li>
<li>
Exit out of cypher-shell and log in again specifying <em>accounting/foo</em>.
</li>
<li>
View the <strong>security.log</strong> file. Do you see these logins and the failed login attempt? The default level of logging is <em>INFO</em> if you do not set the property in the configuration file.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L05-Ex3-log1.png" alt="L05-Ex3-log1" width="1100">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="9">
<li>
Modify the configuration for the security level to be DEBUG.
</li>
<li>
Restart the Neo4j instance.
</li>
<li>
Start cypher-shell specifying the user <em>accounting/accounting</em>.
</li>
<li>
Enter a statement that reads from the database, for example: <code>MATCH (n) RETURN count(n);</code>. You should receive an error because this user does not have the <em>reader</em> role.
</li>
<li>
View the log file. There is information written stating that the read access was checked against the LDAP. Even though access was denied, this information is not written to the log file.
</li>
<li>
Exit out of cypher-shell.
</li>
<li>
Start cypher-shell specifying the user <em>reader/reader</em>.
</li>
<li>
Enter a statement that reads from the database, for example: <code>MATCH (n) RETURN count(n);</code>.
</li>
<li>
View the log file. Again, you should see that the instance contacted the  LDAP Server for role information.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L05-Ex3-log2.png" alt="L05-Ex3-log2" width="1100">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="18">
<li>
Exit out of cypher-shell.
</li>
<li>
Stop the Neo4j instance.
</li>
</ol>
</div>


<div class="paragraph">
<p>So as you have seen, you can audit for logins and failed logins, even with the default security level of <em>INFO</em>.</p>
</div>
</div>
</div>
<div  id="_additional_security_measures" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Additional security measures</h3>


<div class="paragraph">
<p>You may want to consider not using any default ports for your Neo4j instances. Hackers frequently scan IP addresses for commonly used ports, so it’s not uncommon to use
a different port to “fly under the radar”.</p>
</div>


<div class="paragraph">
<p>The <code>neo4j-shell</code> utility has been deprecated and you should not allow any users to use it. By default, it is not enabled in a Neo4j instance.</p>
</div>


<div class="paragraph">
<p>JMX is sometimes used for monitoring system activity. JMX is not secure and by default is disabled in Neo4j.</p>
</div>


<div class="paragraph">
<p>You should work closely with Neo4j Technical Support to ensure that your production system is secure. See this <a href="https://neo4j.com/docs/operations-manual/3.5/security/checklist/">Security Checklist</a> will also help you to determine if you have set up your systems correctly.</p>
</div>
</div>
<div  id="module-5" class="sect1 quiz columns medium-12" style='padding-left: 0;' >
<h3>Check your understanding</h3>
<div  id="_question_1" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Question 1</h3>


<div class="paragraph">
<p>Suppose you will be using an enterprise LDAP provider and you must work with the LDAP administrator to ensure that all users who will be accessing the Neo4j database will have read or write access. What needs to be added to the LDAP?</p>
</div>


<div class="paragraph">
<p>Select the correct answer.</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">The Neo4j plugin for LDAP.</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">The Neo4j LDIF file that is installed with Neo4j.</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">New user entries with the <em>neo4j</em> attribute defined of with a value of <em>reader</em> or <em>writer</em>.</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">New group entries for neo4j roles and modifications to existing user entries to be a group member</span>
</li>
</ul>
</div>
</div>
<div  id="_question_2" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Question 2</h3>


<div class="paragraph">
<p>Suppose that you want to ensure that all data in or out of a Neo4j instance is secure (data-in-transit). What must you configure?</p>
</div>


<div class="paragraph">
<p>Select the correct answers.</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">SSL policy.</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">Enable bolt to use TLS.</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">Restrict HTTP port.</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">Require HTTPS for Neo4j Browser.</span>
</li>
</ul>
</div>
</div>
<div  id="_question_3" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Question 3</h3>


<div class="paragraph">
<p>In order to configure a security policy for SSL in Neo4j, what must you obtain?</p>
</div>


<div class="paragraph">
<p>Select the correct answers.</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">Encrypted pass-phrase file to use from Neo4j support.</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">Digital certificate from a Certificate Authority (public.crt file).</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">SSL library (.jar) from the Certificate Authority.</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">Private key from the Certificate Authority (private.key).</span>
</li>
</ul>
</div>
</div>
</div>
<div  id="_summary" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Summary</h3>


<div class="paragraph">
<p>You should now be able to:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
Describe what security means for an application.
</li>
<li>
Configure a Neo4j instance to use LDAP as the authentication provider.
</li>
<li>
Describe how to secure data-in-transit.
</li>
<li>
Describe how to secure data-at-rest.
</li>
<li>
Configure and use security auditing.
</li>
</ul>
</div>
<a class="next-section medium button" href="../part-6/">Continue to Module 6</a>
<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<script src="https://js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>
<script src="https://cdn.neo4jlabs.com/graphacademy/neo4j-administration/dev/class.js?versionId=QQkIprl5ASprHOnbOAV1TYhEZLYiE8cx" type="text/javascript"></script>
<script src="https://cdn.neo4jlabs.com/graphacademy/neo4j-administration/dev/quizes.js?versionId=7t.XVWWzQelmYXnFiWJ8oHh_2g.hWcII" type="text/javascript"></script>

 <link rel='stylesheet' id='neo-codemirror-css'
    href="https://neo4j.com/wp-content/themes/neo4jweb/assets/css/codemirror-neo.css?ver=4.5" type='text/css'
    media='screen'/>

 <script type='text/javascript'>
  $('.admonitionblock.note').find('.icon').html('NOTE');
  $('.admonitionblock.warning').find('.icon').html('WARNING');
  $('.admonitionblock.information').find('.icon').html('INFO');

  var isBlock = /^(p|li|div|h\\d|pre|blockquote|td)$/;

  function textContent(node, out) {
    if (node.nodeType == 3) return out.push(node.nodeValue);
    for (var ch = node.firstChild; ch; ch = ch.nextSibling) {
      textContent(ch, out);
      if (isBlock.test(node.nodeType)) out.push("\n");
    }
  }

  CodeMirror.colorize = function(collection, defaultMode) {
    if (!collection) collection = document.body.getElementsByTagName("pre");

    for (var i = 0; i < collection.length; ++i) {
      var syntax = false;
      var node = collection[i];
      var mode = node.getAttribute("data-lang") || defaultMode;
      if (mode == "cypher-syntax") {
        syntax = true;
        mode = "cypher";
      }
      if (!mode) continue;

      var text = [];
      textContent(node, text);
      node.innerHTML = "";
      CodeMirror.runMode(text.join(""), mode, node);

      node.className += " cm-s-default";
      if (syntax) {
        node.className += " cypher-syntax";
      }
    }
  };

  $( document ).ready(function() {
    if (CodeMirror.colorize) {
      CodeMirror.colorize(document.body.getElementsByTagName("pre"), 'cypher');
    }
  });
 </script>


<script>
  window.intercomSettings = {
    app_id: "dt0ig5ab",
    hide_default_launcher: true
  };
</script>
<script>(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',intercomSettings);}else{var d=document;var i=function(){i.c(arguments)};i.q=[];i.c=function(args){i.q.push(args)};w.Intercom=i;function l(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/dt0ig5ab';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);}if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})()</script>

<!-- JWT decoder: ONLY USE TO SEE UN-VERIFIED VALUES -->
<script src="https://neo4jsandbox.com/js/jwt-decode.min.js"></script>


<script>
const SITE_URL = window.location;

var getTimeDiff = function(time1, time2) {
  var hourDiff = time2 - time1;
  var diffDays = Math.floor(hourDiff / 86400000);
  var diffHrs = Math.floor((hourDiff % 86400000) / 3600000);
  var diffMins = Math.floor(((hourDiff % 86400000) % 3600000) / 60000);
  return {"days": diffDays, "hours": diffHrs, "mins": diffMins};
}

var attemptRenewToken = function(silent, nextTimeout, nextTimeoutSilent) {
  console.log('renewAuth attempting');
  var iframe = document.createElement('iframe');
  iframe.style.display = 'none';
  iframe.src = 'https://neo4j.com/accounts/login?targetUrl=' + encodeURIComponent(SITE_URL);
  document.body.appendChild(iframe);
  if (nextTimeout) {
      setTimeout(
        function () {
          attemptRenewToken(nextTimeoutSilent, nextTimeout, nextTimeoutSilent);
        }, nextTimeout
      );
  }
}

var logout = function() {
  window.location = 'https://neo4j.com/graphacademy/online-training/introduction-to-neo4j/'
}

$( document ).ready(function() {
    var id_token = Cookies.get("com.neo4j.accounts.idToken");
    var decoded_token = jwt_decode(id_token);
    var expiresIn = getTimeDiff(Date.now(), (decoded_token.exp) * 1000);
    if (expiresIn.days > 0 || expiresIn.hours > 0) {
      // token is good.
    } else if (expiresIn.days == 0 && expiresIn.hours == 0 && expiresIn.mins > 1 && expiresIn.mins < 60) {
        // expiring soon, let's immediately get a new token
        attemptRenewToken(true, 1000*60*30, false);
    } else {
        // token is already expired, log user out in UI; token won't work
        logout();
    }
    getQuizStatus();


    var userInfoIntercom = Cookies.getJSON("com.neo4j.accounts.userInfo");
    if (userInfoIntercom) {
      try {
        window.Intercom("update", {
          app_id: "dt0ig5ab",
          name: userInfoIntercom.name,
          email: userInfoIntercom.email,
          user_id: userInfoIntercom.sub,
          hide_default_launcher: true
        });;
      } catch (err) {
        console.error(err);
      }
    }
    Intercom('trackEvent','training-introv2-view');
});
</script>
<script>
$( document ).ready(function() {
  Intercom('trackEvent','training-admin-view-part5');
});
</script>
</div>
</div>
<div id="sidebar-wrapper">
        
        <div id="toc" class="toc2">
        <div id="toctitle">Module: Security in Neo4j</div>
        <ul class="sectlevel1">
<li><a href="#_about_this_module">About this module</a></li>
<li><a href="#_what_is_application_security">What is application security?</a>
<ul class="sectlevel2">
<li><a href="#_data_security">Data security</a></li>
<li><a href="#_access_control">Access control</a></li>
<li><a href="#_user_privacy">User privacy</a></li>
<li><a href="#_securing_a_neo4j_application">Securing a Neo4j application</a></li>
<li><a href="#_building_security_into_your_neo4j_application">Building security into your Neo4j application</a></li>
<li><a href="#_securing_the_deployed_application_and_infrastructure">Securing the deployed application and infrastructure</a></li>
</ul>
</li>
<li><a href="#_neo4j_software_updates">Neo4j software updates</a></li>
<li><a href="#_authentication_in_neo4j">Authentication in Neo4j</a>
<ul class="sectlevel2">
<li><a href="#_enabling_authentication">Enabling authentication</a></li>
<li><a href="#_how_roles_are_used_for_users">How roles are used for users</a></li>
<li><a href="#_using_ldap_for_authentication_and_authorization">Using LDAP for authentication and authorization</a>
<ul class="sectlevel3">
<li><a href="#_adding_groups_for_roles_in_ldap">Adding groups for roles in LDAP</a></li>
<li><a href="#_querying_the_ldap_server">Querying the LDAP Server</a></li>
<li><a href="#_exercise_1_exploring_the_training_user_directory"><strong>Exercise #1: Exploring the training User Directory</strong></a></li>
<li><a href="#_configuring_neo4j_for_ldap_authentication_and_authorization">Configuring Neo4j for LDAP authentication and authorization</a></li>
<li><a href="#_multiple_authentication_providers">Multiple authentication providers</a></li>
<li><a href="#_turn_off_role_mapping_temporary">Turn off role mapping (temporary)</a></li>
<li><a href="#_exercise_2_configuring_authentication_for_a_stand_alone_instance"><strong>Exercise #2: Configuring authentication for a stand-alone instance</strong></a></li>
<li><a href="#_ldap_caching">LDAP caching</a></li>
<li><a href="#_using_secure_ldap">Using secure LDAP</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_securing_data_in_transit">Securing data-in-transit</a>
<ul class="sectlevel2">
<li><a href="#_how_to_secure_data_in_transit">How to secure data-in-transit</a>
<ul class="sectlevel3">
<li><a href="#_recommendations_for_external_users_using_your_application_over_the_internet">Recommendations for external users using your application over the Internet</a></li>
</ul>
</li>
<li><a href="#_configuring_the_neo4j_instance_for_ssltls">Configuring the Neo4j instance for SSL/TLS</a></li>
<li><a href="#_ssl_for_causal_clusters">SSL for Causal Clusters</a></li>
<li><a href="#_ssl_for_backups">SSL for backups</a></li>
<li><a href="#_additional_settings_related_to_data_in_transit">Additional settings related to data-in-transit</a></li>
<li><a href="#_best_practices_for_developers">Best practices for developers</a></li>
</ul>
</li>
<li><a href="#_securing_data_at_rest">Securing data-at-rest</a>
<ul class="sectlevel2">
<li><a href="#_securing_files_at_the_os_level">Securing files at the OS level</a></li>
<li><a href="#_ensure_that_neo4j_does_not_run_as_root">Ensure that Neo4j does not run as root</a></li>
</ul>
</li>
<li><a href="#_security_auditing">Security auditing</a>
<ul class="sectlevel2">
<li><a href="#_exercise_3_security_auditing"><strong>Exercise #3: Security auditing</strong></a></li>
</ul>
</li>
<li><a href="#_additional_security_measures">Additional security measures</a></li>
<li><a href="#module-5">Check your understanding</a>
<ul class="sectlevel2">
<li><a href="#_question_1">Question 1</a></li>
<li><a href="#_question_2">Question 2</a></li>
<li><a href="#_question_3">Question 3</a></li>
</ul>
</li>
<li><a href="#_summary">Summary</a></li>
</ul>
        </div>
<div id="progress" style="position:absolute; bottom:100;"></div>
</div>