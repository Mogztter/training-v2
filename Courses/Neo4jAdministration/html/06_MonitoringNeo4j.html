<html>
   <head>
      <!-- Global site tag (gtag.js) - Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-1192232-34"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-1192232-34');
      </script>
      <meta charset="utf-8"></meta>
      <meta name="viewport" content="width=device-width, initial-scale=1.0"></meta>
      <title>Neo4j GraphAcademy: Neo4j Administration</title>
      <link rel="stylesheet" type="text/css" href="https://neo4j.com/docs/developer-manual/current/docbook.css"></link>
      <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"></link>
      <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css"></link>
      <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,400italic,600,300italic"></link>
      <link rel="stylesheet" type="text/css" href="https://neo4j.com/docs/developer-manual/current/css/extra.css"></link>
      <link rel="stylesheet" type="text/css" href="https://neo4j.com/docs/developer-manual/current/css/chunked-base.css"></link>
      <link rel="stylesheet" type="text/css" href="https://neo4j.com/docs/developer-manual/current/css/console.css"></link><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js" type="text/javascript"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" type="text/javascript"></script>
      <link rel="shortcut icon" href="https://neo4j.com/wp-content/themes/neo4jweb/favicon.ico"></link>
      <script type='text/javascript'
   src='https://neo4j.com/wp-content/themes/neo4jweb/assets/js/vendor/codemirror.min.js?ver=4.5.2'></script>
      <script type='text/javascript'>
        window.trainingPartName = "module-6";
      </script>
   </head>
   <body>
      <header style="top: 0px;">
         <a href="../part-0/" id="logo"><img src="https://neo4j.com/wp-content/themes/neo4jweb/assets/images/neo4j-logo-2015.png" alt="Neo4j Logo"></a>
         <ul class="documentation-library">
            <li id="menu-module-1">
              <a href="../part-1/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">1</strong>
              </span>
              Intro to Neo4j</a>
            </li>
            <li id="menu-module-2">
              <a href="../part-2/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">2</strong>
              </span>
              Overview Of Admin</a>
            </li>
            <li id="menu-module-3">
              <a href="../part-3/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">3</strong>
              </span>
              Managing a DB</a>
            </li>
            <li id="menu-module-4">
              <a href="../part-4/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">4</strong>
              </span>
              Causal Clustering</a>
            </li>
            <li id="menu-module-5">
              <a href="../part-5/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">5</strong>
              </span>
              Security</a>
            </li>
            <li id="menu-module-6">
              <a href="../part-6/" style="color: #000">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">6</strong>
              </span>
              Monitoring</a>
            </li>
            <li id="menu-module-7">
              <a href="../part-7/">
              <span class="fa-stack" style="margin-top: -2px">
                <span class="fa fa-circle-o fa-stack-2x"></span>
                <strong class="fa-stack-1x">7</strong>
              </span>
              The End</a>
            </li>
         </ul>
         <nav id="header-nav">
         <span class="nav-previous">
           
              <a accesskey="p" href="../part-5/">
                <span class="fa fa-long-arrow-left" aria-hidden="true"></span>
              Security</a>
           
         </span>
         <span class="nav-current">
           <p class="nav-title" style="display: none;"></p>
         </span>
         <span class="nav-next">
           
              <a accesskey="n" href="../part-7/">The End
                <span class="fa fa-long-arrow-right" aria-hidden="true"></span>
              </a>
           
         </span>
         </nav>
      </header>


<div id="developer-manual" style="padding-top: 150px; padding-left: 20px; padding-bottom: 100px;">
<h1>Monitoring  Neo4j</h1>

      <div id="preamble columns medium-12">
<div class="sectionbody">
<script src="https://browser.sentry-cdn.com/4.4.1/bundle.min.js" crossorigin="anonymous"></script>
<script type='text/javascript'>
	var loc = window.location;
	document.write(unescape("%3Cscript src='https://munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script>
window.trainingClassName = 'neo4j-administration';
</script>

<script>Munchkin.init('773-GON-065');</script>


<style>
    @import "https://neo4j.com/online_training/cypher-gadget/libs/jquery.modal.min.css" screen;
    .modal {
        width: 775px;
        height: 775px;
        padding: 10px;
        margin: 0;
    }
    .blocker {
        height: initial;
        background-color: transparent;
    }
  a.button {
    display: block;
    text-align: center;
    width: 250px;
    font-size: 18px;
    margin-top: 50px;
    font-family: 'Open Sans';
    height: 55px;
    border-style: solid;
    border-width: 0;
    cursor: pointer;
    color: white;
    padding: 15px;
    font-weight: 300;
    background-color: #6dcc9c;
    border-color: #4ac084;
  }

  .button a hover {
      background-color: #4ac084;
  }

  pre.cypher-syntax {
    background-color: #eaf1f8;
  }
</style>
<script src="https://neo4j.com/online_training/cypher-gadget/libs/underscore.js"></script>
<script src="https://neo4j.com/online_training/cypher-gadget/libs/jquery.js"></script>
<script src="https://neo4j.com//online_training/cypher-gadget/libs/jquery-ui.min.js"></script>
<script src="https://neo4j.com/online_training/cypher-gadget/libs/jquery.modal.min.js"></script>
<script src="http://s3.amazonaws.com/dev.assets.neo4j.com/wp-content/js/js.cookie-2.1.3.min.js"></script>
<!--script src="/online_training/gadgetUtils.js"></script-->
<script type="text/javascript">
  Sentry.init({ dsn: 'https://652808557bb1478883636c96edb51739@sentry.io/1342352' });
</script>
<script src="https://neo4j.com/online_training/tasks.js"></script>
<script type="text/javascript">
function renderGadget(containerSelector, options) {
  if (!options.cypherSetup) return;
  var frameId = _.uniqueId("exmodal");
  $(containerSelector).append('<button onclick="setGadgetUrl(\'#' + frameId +
    '\')" rel="modal:open" class="btn">' + (options.label || 'Gadget') + '</button>');

    $(containerSelector).append(modalWindow(frameId,options));
  }

function modalWindow(frameId, options) {
   return `<div id="${frameId}" class="modal-dialog modal fade draggable" style="display:none;text-align:center;vertical-align:middle;" >
            <iframe data-src="/online_training/cypher-gadget/test.html?cypherSetup=${options.cypherSetup}&${formatTask(options)}" width="725" height="725" frameborder="0" style="margin:5px;"
              webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
           <div>`;
}
/*
    .modal {
        width: 775px;
        height: 675px;
        padding: 10px;
        margin: 0;
    }
*/

function formatTask(options) {
  if (options.task) return "cypherTaskJSON="+encodeURIComponent(JSON.stringify(options.task));
  if (options.taskName) return "cypherTask="+options.taskName;
  return "";
}


function setGadgetUrl(sel) {
  $(sel).modal();
  $(sel).draggable();
  var $iframe = $(sel).find("iframe");
  $iframe.attr("src", $iframe.data("src"));
}
</script>
</div>
</div>
<div  id="_about_this_module" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>About this module</h3>


<div class="paragraph">
<p>Now that you have gained experience managing a Neo4j instance and database,  managing Neo4j Causal Clusters, and the steps you must take to secure your deployed Neo4j application, you will learn how to monitor the Neo4j instance as it is used by applications.</p>
</div>


<div class="paragraph">
<p>At the end of this module, you should be able to:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
Describe the categories of monitoring and measurement you can perform with Neo4j.
</li>
<li>
Monitor:
<div class="ulist">
<ul>
<li>
queries
</li>
<li>
transactions
</li>
<li>
connections
</li>
<li>
memory usage
</li>
</ul>
</div>
</li>
<li>
Manage log files.
</li>
<li>
Manage the collection of Neo4j metrics.
</li>
<li>
Use JMX queries.
</li>
</ul>
</div>
</div>
<div  id="_monitoring_in_neo4j" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Monitoring in Neo4j</h3>


<div class="paragraph">
<p>As an administrator, you should configure your deployed Neo4j application so that you can perform routine monitoring of activity, as well as being prepared to more deeply monitor and possibly re-configure Neo4j.</p>
</div>


<div class="paragraph">
<p>The Neo4j instance writes events to log files where you can configure the level of logging you want to perform. In addition, Neo4j writes metrics to a directory that is dedicated for collecting runtime data. The <a href="https://neo4j.com/docs/operations-manual/3.5/configuration/file-locations/">Neo4j Operations Manual</a> describes these files and locations that you will be working with in this module.</p>
</div>


<div class="paragraph">
<p>Some linux installations may use a system service to collect log files and allow you to access log data with <code>journalctl</code> as described in the <a href="https://neo4j.com/docs/operations-manual/3.5/installation/linux/systemd/">Neo4j Operations Manual</a>. You have already seen some of the events that are written to the <strong>neo4j.log</strong> file (<code>journalctl -u neo4j</code> on Debian)  when the Neo4j instance starts and you want to confirm that it started successfully. In addition, you have seen error events written to <strong>debug.log</strong> when attempting to start a Neo4j instance in a Causal Cluster. You have also seen authentication events that are written to the <strong>security.log</strong> file when users connect to the Neo4j instance.</p>
</div>
<div  id="_monitoring_log_files" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Monitoring log files</h3>


<div class="paragraph">
<p>In the previous module, <em>Security in Neo4j</em>, you learned about the authentication events that are written to the <strong>security.log</strong> file. The categories of events that you configure for and monitor in log files that you will learn about in this module include:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
Queries
</li>
<li>
Transactions
</li>
<li>
Connections
</li>
<li>
Memory
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
You have learned how to monitor core and read replica servers in a Neo4j Causal Cluster in the module, <em>Causal Clustering in Neo4j</em>.
</td>
</tr>
</table>
</div>
</div>
<div  id="_collecting_metrics" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Collecting metrics</h3>


<div class="paragraph">
<p>In addition, you can configure the Neo4j instance to collect metrics that are related to events, but can be viewed in tools (such as Grafana) that use the Graphite or Prometheus protocols to help you monitor your application. In most cases, you will want to configure a tool such as Nagios to provide alerts when certain metrics or events are detected in Neo4j. Note that you can also set up alerts in Grafana, but Nagios is a better choice for alerts. CloudWatch is another UI that is commonly use for monitoring and alerting with AWS deployments.</p>
</div>
</div>
</div>
<div  id="_monitoring_queries" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Monitoring queries</h3>


<div class="paragraph">
<p>In a production environment, you want to know if a query is taking a long time and using too many resources. A user/application may not even be aware that their query is hung. For example, if they started a query and then walked away from their computer.</p>
</div>


<div class="paragraph">
<p>As an administrator, you can configure Neo4j to write information about queries that completed to the <strong>query.log</strong> file. You can provide settings that will log information about queries that took a long time to complete. You can also monitor currently running queries and if need be, kill them if they are taking too long.</p>
</div>
<div  id="_configuring_query_logging" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Configuring query logging</h3>


<div class="paragraph">
<p>You can configure Neo4j to log an event if a query runs more than xx milliseconds. There is no standard for what a reasonable period of time is for a query, but in most databases, a query that runs for minutes is not a good thing! At a minimum, you should enable logging for queries and set a threshold for the length of time queries take. Then, as part of your monitoring, you could regularly inspect the <strong>query.log</strong> file to determine if a certain set of queries or users are possibly performing queries that tax the resources of the Neo4j instance.</p>
</div>


<div class="paragraph">
<p>For example, here are the properties you would set in the Neo4j configuration to log a message and provide information when a query takes more than 1000ms to complete:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>dbms.logs.query.enabled=true
dbms.logs.query.threshold=1000ms
dbms.logs.query.parameter_logging_enabled=true
dbms.logs.query.time_logging_enabled=true
dbms.logs.query.allocation_logging_enabled=true
dbms.logs.query.page_logging_enabled=true
dbms.track_query_cpu_time=true
dbms.track_query_allocation=true</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>The <a href="https://neo4j.com/docs/operations-manual/3.5/monitoring/logging/query-logging/">Neo4j Operations Manual</a> has a section on the configuration settings you can specify to log query events to the <strong>query.log</strong> file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
If you have Neo4j Desktop installed on a system, you can use it to run an application called Query Log Analyzer, written by an engineer from Neo4j. This application is a useful tool for viewing queries on your Neo4j Enterprise instance. Here is the <a href="https://medium.com/neo4j/meet-the-query-log-analyzer-30b3eb4b1d6">Medium article</a> that describes the tool and how to install it.
</td>
</tr>
</table>
</div>
</div>
<div  id="_long_running_queries" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Long-running queries</h3>


<div class="paragraph">
<p>Inspecting the log file for queries that completed in more than XX milliseconds provides historical information, but what if you suspect that a query is running too long or is hung?</p>
</div>


<div class="paragraph">
<p>There are two reasons why a Cypher query may take a long time:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
The query returns a lot of data. The query completes execution in the graph engine, but it takes a long time to create the result stream.
<div class="ulist">
<ul>
<li>
Example: <code>MATCH (a)--(b)--(c)--(d)--(e)--(f) RETURN a</code>
</li>
</ul>
</div>
</li>
<li>
The query takes a long time to execute in the graph engine.
<div class="ulist">
<ul>
<li>
Example: <code>MATCH (a), (b), (c), (d), (e) RETURN count(id(a))</code>
</li>
</ul>
</div>
</li>
</ul>
</div>


<div class="paragraph">
<p>If the query executes and then <strong>returns a lot of data</strong>, there is no way to monitor it or kill the query.  If the Neo4j instance has many of these <strong>rogue</strong> queries running, it will slow down considerably so you should aim to limit these types of queries.</p>
</div>
</div>
<div  id="_viewing_currently_running_queries_neo4j_browser" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Viewing currently running queries (Neo4j Browser)</h3>


<div class="paragraph">
<p>In Neo4j Browser you can use the <code>:queries</code> command to see all currently running queries:</p>
</div>
<div class="imageblock">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/ListQueriesBrowser.png" alt="ListQueriesBrowser" width="1000">
</p>
</div>
</div>
<div  id="_viewing_currently_running_queries_cypher_shell" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Viewing currently running queries (cypher-shell)</h3>


<div class="paragraph">
<p>In <code>cypher-shell</code> you execute <code>CALL dbms.listQueries() YIELD username, queryId, query, elapsedTimeMillis;</code>.</p>
</div>
<div class="imageblock">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/ListQueriesCypher-shell.png" alt="ListQueriesCypher-shell" width="1000">
</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
Due to a limitation in the database, there is a very small possibility that not all queries will be returned when you run <code>dbms.listQueries()</code>.
</td>
</tr>
</table>
</div>


<div class="paragraph">
<p>Another statement you can use to view long-running queries and any type of transaction running in the Neo4j instance is <code>CALL dbms.listTransactions();</code> which you will use in the next Exercise.</p>
</div>


<div class="paragraph">
<p>If you have the <em>admin</em> role, you can view (and kill) queries from all users. If you do not have an <em>admin</em> role, you will only be able to view your own queries.</p>
</div>
</div>
<div  id="_killing_a_long_running_query" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Killing a long-running query</h3>


<div class="paragraph">
<p>Recall that a user (or application) that issues a long-running query may not be able to stop the query. You would need to intervene and kill the query for the user.</p>
</div>


<div class="paragraph">
<p>Once you have identified the long-running query that you want to kill, in Neo4j Browser, you can kill it by double-clicking the icon in the <em>Kill</em> column.</p>
</div>
<div class="imageblock">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/KillQueryBrowser.png" alt="KillQueryBrowser" width="1000">
</p>
</div>
<div  id="_killing_a_long_running_query_cypher_shell" class="sect3 "  >
<h4>Killing a long-running query (cypher-shell)</h4>


<div class="paragraph">
<p>Alternatively, in <code>cypher-shell</code> you can execute the statement <code>CALL dbms.killQuery('query-id');</code>.</p>
</div>
<div class="imageblock">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/KillQueryCypher-shell.png" alt="KillQueryCypher-shell" width="800">
</p>
</div>
</div>
</div>
<div  id="_exercise_1_monitoring_queries" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise #1: Monitoring queries</strong></h3>


<div class="paragraph">
<p>In this Exercise, you enable query logging where an event will be written to the <strong>query.log</strong> file for a query that took more than 1000ms to complete. Then you will monitor and detect a long-running query and kill it.</p>
</div>


<div class="paragraph">
<p><strong>Before you begin:</strong></p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
For this Exercise, you will be using the stand-alone Neo4j instance that you configured for authentication in the previous module, <em>Security in Neo4j</em>.
</li>
<li>
Ensure that the database you are using is <strong>movie3.db</strong>.
</li>
</ol>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Modify the <strong>neo4j.conf</strong> file to create a log record if a query exceeds 1000 ms.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex1-LogQueriesTooLong.png" alt="L06-Ex1-LogQueriesTooLong" width="600">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="2">
<li>
Start/restart the Neo4j stand-alone instance.
</li>
<li>
Open a new terminal window and log in to <code>cypher-shell</code> with the <em>reader/reader</em> credentials. (<strong>Suggestion</strong>: specify --format plain)
</li>
<li>
In this <code>cypher-shell</code> session, enter the following statement which will execute a query that runs for longer than 1000 ms: <code>MATCH (a), (b), (c), (d) RETURN count(id(a));</code>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
You should <span class="underline">never</span> run this type of query against a large database. It is only presented here for illustrative purposes to show  a long-running query.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="5">
<li>
Wait about a minute, it should complete.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex1-LongQuery.png" alt="L06-Ex1-LongQuery" width="800">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="6">
<li>
In the terminal window where you started the Neo4j instance, view the <strong>query.log</strong>. Is there a record for this query?
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex1-QueryLog.png" alt="L06-Ex1-QueryLog" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="7">
<li>
In <code>cypher-shell</code> session for <em>reader</em>, enter a query that will execute for an even longer period of time:  <code>MATCH (a), (b), (c), (d), (e) RETURN count(id(a));</code>.
</li>
<li>
Open a new terminal window and log in to cypher-shell with the <em>admin/admin</em> credentials. (<strong>Suggestion</strong>: specify --format plain)
</li>
<li>
In this second <em>admin</em> <code>cypher-shell</code> session, execute the Cypher statement to list transactions. Do you see the query from <em>reader</em>?
</li>
<li>
Then execute the same statement returning the username, currentQueryId, currentQuery, and elapsedTimeMillis.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex1-ListTransactions.png" alt="L06-Ex1-ListTransactions" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="11">
<li>
In the second <em>admin</em> <code>cypher-shell</code> session, execute the Cypher statement to kill the long-running query.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex1-KillQuery.png" alt="L06-Ex1-KillQuery" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="11">
<li>
Observe in the <em>reader_</em> <code>cypher-shell</code> session that the query has been killed.
</li>
</ol>
</div>
</div>
<div  id="_automating_monitoring_of_queries" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Automating monitoring of queries</h3>


<div class="paragraph">
<p>Some queries against the Neo4j instance are not simply queries, but are Cypher statements that load data from CSV files. These types of Cypher statements could take a considerable amount of time to complete. One option for you to help automate the killing of long-running queries is to create a script that executes a Cypher statement such as the following:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>CALL dbms.listQueries() YIELD query, elapsedTimeMillis, queryId, username
WHERE  NOT query CONTAINS toLower('LOAD')
AND elapsedTimeMillis &gt; 30000
WITH query, collect(queryId) AS q
CALL dbms.killQueries(q) YIELD queryId
RETURN query, queryId;</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>This Cypher statement will retrieve all queries that are running for longer than 30000 ms that do not perform a LOAD operation and kill them. You could place this code into a script that is run at regular intervals.</p>
</div>
</div>
</div>
<div  id="_monitoring_transactions" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Monitoring transactions</h3>


<div class="paragraph">
<p>In the previous Exercise, you saw that you can query the Neo4j instance for currently running queries, as well as currently running transactions. Transactions and their successful completion are important for any production Neo4j instance. As an administrator, you must be able to confirm through monitoring and configuration settings that transactions are completing within a specified period of time.</p>
</div>


<div class="paragraph">
<p>A transaction is either a read-only transaction or a read-write transaction. Read-only transactions never block other clients as they acquire <em>share</em> locks, but can take a long period of time to execute as you saw in the previous Exercise. A read-write transaction acquires <em>exclusive</em> locks during the transaction and may be blocked by other transactions that have acquired <em>exclusive</em> locks on the same resources. In some scenarios, a deadlock could occur if one transaction is blocked and is also blocking another transaction from acquiring the exclusive locks it needs.</p>
</div>


<div class="paragraph">
<p>In a multi-user read-write transactional application, you should should configure the Neo4j instance so that a transaction will be aborted if it cannot obtain <em>exclusive</em> locks after a certain period of time. This will eliminate a deadlock situation.</p>
</div>


<div class="paragraph">
<p>In addition, you should configure an upper limit for how long a transaction can run. This will depend on your particular application, but it should be set to a value that is greater than the lock timeout value. This is called a <em>transaction guard</em> which is a good thing in a production system. In fact, you can use <em>transaction guard</em> to automatically kill queries that take longer than xx minutes to execute.</p>
</div>
<div  id="_example_configuring_transaction_guard" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Example: Configuring transaction guard</h3>


<div class="paragraph">
<p>Here is an example of the configuration settings for lock acquisition timeout and <em>transaction guard</em> where the transaction will fail if it exceeds one second or the request waits more than 10 milliseconds to acquire a write lock:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre># transaction guard: max duration of any transaction
dbms.transaction.timeout=1s
# max time to acquire write lock
dbms.lock.acquisition.timeout=10ms</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>When a lock timeout occurs or when a transaction times out, the client will receive an error and a record is written to the <strong>debug.log</strong> file.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
If you set a transaction timeout without setting the lock timeout, the client session may be deadlocked and the transaction cannot be terminated. This is why it is important to set <span class="underline">both</span> of these properties in your Neo4j configuration.
</td>
</tr>
</table>
</div>
</div>
<div  id="_exercise_2_monitoring_transactions" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise #2: Monitoring transactions</strong></h3>


<div class="paragraph">
<p>In this Exercise, you configure Neo4j to <span class="underline">not</span> allow transactions that take longer than one second to complete.</p>
</div>


<div class="paragraph">
<p><strong>Before you begin:</strong></p>
</div>


<div class="paragraph">
<p>For this exercise, you will be using the stand-alone Neo4j instance that you used in the previous Exercise.</p>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Modify the <strong>neo4j.conf</strong> file to terminate transactions where the client cannot obtain a write lock after 10 milliseconds or the transaction time exceeds 1 second.
</li>
<li>
Start or restart the Neo4j instance.
</li>
<li>
In a terminal window, log in to <code>cypher-shell</code> with the credentials <em>publisher/publisher</em>.
</li>
<li>
Enter this Cypher statement which will attempt to execute a write transaction to create a million <em>Person</em> nodes: <code>FOREACH (i IN RANGE(1,1000000) | CREATE (:Person {name:'Person' + i}));</code>. Do you receive an error?
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex2-LongTransactionTimeOut.png" alt="L06-Ex2-LongTransactionTimeOut" width="800">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="5">
<li>
View the record written to <strong>debug.log</strong>.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex2-LongTransactionTimeOutLog.png" alt="L06-Ex2-LongTransactionTimeOutLog" width="1000">
</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
If you attempt to create more than a million <em>Person</em> nodes, you will run into other problems, most notably, running out of virtual memory in the Neo4j instance. You will learn about configuring virtual memory later in this module.
</td>
</tr>
</table>
</div>
</div>
<div  id="_monitoring_locks" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Monitoring locks</h3>


<div class="paragraph">
<p>You can query the Neo4j instance&#8217;s currently running transactions. If you see transactions that are running for a long time, you can further query the Neo4j instance to determine what locks each long-running query is holding. To read more about monitoring locks, see this <a href="https://support.neo4j.com/hc/en-us/articles/360006827474-How-to-diagnose-locking-issues">Neo4j Support Knowledge Base article</a>.</p>
</div>
</div>
</div>
<div  id="_monitoring_connections" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Monitoring connections</h3>


<div class="paragraph">
<p>A Neo4j instance (stand-alone or cluster mode) uses a set of ports for inter-cluster communication and a set of ports for client communication. When you configure the Neo4j instance, you should ensure that the configured ports are available and are not blocked by a firewall.</p>
</div>


<div class="paragraph">
<p>The default ports used by a Neo4j instance are documented in the <a href="https://neo4j.com/docs/operations-manual/3.5/configuration/ports/">Neo4j Operations Manual</a>. And you have learned that you can modify the port numbers used by a Neo4j instance. As you learned in a previous lesson about securing Neo4j, for a secure Neo4j application, you should <span class="underline">not</span> use any default port numbers.</p>
</div>


<div class="paragraph">
<p>As an administrator, you can view the current connections to a Neo4j instance from <code>cypher-shell</code> by executing the call to <code>dbms.listConnections()</code>:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/listConnections.png" alt="listConnections" width="1100">
</p>
</div>


<div class="paragraph">
<p>The connection with the userAgent value of <em>neo4j-java/dev</em> is the cypher-shell session. Any connections that are <em>javascript</em> are from the Web interface to Neo4j Browser. The other connections are for a <em>java</em> application. You could write a query to screen for connections from certain IP addresses that are forbidden. How you identify these IP addresses will depend on your security administrator for your application.</p>
</div>
<div  id="_monitoring_and_terminating_connections" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Monitoring and terminating connections</h3>


<div class="paragraph">
<p>With <code>dbms.listConnections()</code>, you can identify a connection that:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
has been connected to the Neo4j instance for too long a time period.
</li>
<li>
is from a user that you do not want connecting to the Neo4j instance.
</li>
<li>
is from a suspect IP address.
</li>
</ul>
</div>


<div class="paragraph">
<p>You terminate the connection to the Neo4j instance with a call to <code>dbms.killConnection()</code> where you can provide the connection ID or a comma-separated list of connection IDs with the format <code>['connectID-xx','connectID-yy']</code>.</p>
</div>
</div>
<div  id="_exercise_3_monitoring_connections" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise #3: Monitoring connections</strong></h3>


<div class="paragraph">
<p>In this Exercise, you access the Neo4j instance from multiple clients and monitor the connections.</p>
</div>


<div class="paragraph">
<p><strong>Before you begin:</strong></p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Make sure that you have exited out of any <code>cypher-shell</code> sessions.
</li>
<li>
Download the writeApp java application zip file located <a href="https://s3-us-west-1.amazonaws.com/data.neo4j.com/admin-neo4j/writeApp.zip">here</a>. <strong>Hint</strong>: Enter <code>wget <a href="https://s3-us-west-1.amazonaws.com/data.neo4j.com/admin-neo4j/writeApp.zip" class="bare">https://s3-us-west-1.amazonaws.com/data.neo4j.com/admin-neo4j/writeApp.zip</a></code>.
</li>
<li>
Unzip <strong>writeApp.zip</strong> which will create the folder <strong>writeApp</strong>.
</li>
<li>
Make sure that <strong>write.sh</strong> has execute permissions (<code>chmod +x write.sh</code>)
</li>
</ol>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
In a terminal window, log in to <code>cypher-shell</code> with the credentials <em>admin/admin</em>.
</li>
<li>
Enter the Cypher statement to list all connections to the Neo4j instance.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex3-ListConnections1.png" alt="L06-Ex3-ListConnections1" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="3">
<li>
In a different terminal window, log in to <code>cypher-shell</code> with the credentials <em>publisher/publisher</em>.
</li>
<li>
Enter the Cypher statement to list all connections to the Neo4j instance. Do you only see the connections for your user ID?
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex3-ListConnections2.png" alt="L06-Ex3-ListConnections2" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="5">
<li>
In the first <em>admin</em> <code>cypher-shell</code> session, enter the Cypher statement to list all connections to the Neo4j instance.  Do you see all of the connections?
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex3-ListConnections3.png" alt="L06-Ex3-ListConnections3" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="6">
<li>
In a third terminal window navigate to the <strong>writeApp</strong> folder you created when you unzipped the java application.
</li>
<li>
Enter <code>./write.sh localhost 7687</code>. This java application will open a connection to the Neo4j instance and will ask you to press <strong>Enter</strong> to continue. Do <span class="underline">not</span> press <strong>Enter</strong>.
</li>
<li>
In the <em>admin</em> <code>cypher-shell</code> session, enter the Cypher statement to list all connections.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex3-ListConnections4.png" alt="L06-Ex3-ListConnections4" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="9">
<li>
In the <em>admin</em> <code>cypher-shell</code> session, enter the Cypher statement to kill the java client connections for <em>publisher</em>.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex3-KillConnection.png" alt="L06-Ex3-KillConnection" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="10">
<li>
In the window where the write Java application is waiting for you to press <strong>Enter</strong>, press the <strong>Enter</strong> key. You should see a message that the connection was closed.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex3-KillConnection2.png" alt="L06-Ex3-KillConnection2" width="800">
</p>
</div>
</div>
<div  id="_logging_http_requests" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Logging HTTP requests</h3>


<div class="paragraph">
<p>You may want to monitor requests that come into the Neo4j instance from browser clients as these types of requests are typically not part of an application, but rather a user connecting to the server with their credentials.</p>
</div>


<div class="paragraph">
<p>You can set this property in <strong>neo4j.conf</strong> to log these requests:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre># To enable HTTP logging, uncomment this line
dbms.logs.http.enabled=true</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>With HTTP logging enabled, you will see records for each HTTP request so you should also limit the number of log files to keep and their sizes. Part of your monitoring might be to look for certain patterns in the <strong>http.log</strong> file(s) and in particular, requests made from IP addresses that you may not want accessing the instance.</p>
</div>
</div>
<div  id="_exercise_4_monitoring_http_requests" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise #4: Monitoring HTTP requests</strong></h3>


<div class="paragraph">
<p>In this Exercise, you enable the Neo4j instance for logging HTTP requests and monitor them.</p>
</div>


<div class="paragraph">
<p><strong>Before you begin:</strong></p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Make sure that you have exited out of any cypher-shell sessions.
</li>
<li>
Stop the Neo4j instance.
</li>
</ol>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
In a terminal window, modify the Neo4j configuration to log HTTP requests.
</li>
<li>
Start the Neo4j instance.
</li>
<li>
In a browser, connect to the Neo4j instance using port 7474. Connect to the server as <em>reader/reader</em>.
</li>
<li>
View the schema of the database by executing: <code>CALL db.schema();</code>
</li>
<li>
View the records in the <strong>http.log</strong> file.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex4-HTTPLog.png" alt="L06-Ex4-HTTPLog" width="1200">
</p>
</div>
</div>
</div>
<div  id="_monitoring_memory_usage" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Monitoring memory usage</h3>


<div class="paragraph">
<p>There are many properties that you can set to control how the Neo4j instance executes at runtime. The default values provided in the <strong>neo4j.conf</strong> file are useful for a small database with a small number of connections. In a production environment and in a Causal Cluster environment, you must make sure that the settings for the JVM are the best ones for your particular application.</p>
</div>


<div class="paragraph">
<p>This training does not teach about performance tuning, but it introduces you to how memory is used by a Neo4j instance and how you can perform basic monitoring of memory usage.</p>
</div>


<div class="paragraph">
<p>In a JVM, memory is consumed by a number of internal resources:</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>JVM Memory Usage</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Heap</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">The heap is where your Class instantiations or “Objects” are stored.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Thread stacks</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Each thread has its own call stack. The stack stores primitive local variables and object references along with the call stack (list of method invocations) itself. The stack is cleaned up as stack frames move out of context so there is no GC performed here.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Metaspace</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Metaspace stores the Class definitions of your Objects, and some other metadata.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Code cache</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">The JIT compiler stores native code it generates in the code cache to improve performance by reusing it.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Garbage Collection</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">In order for the GC to know which objects are eligible for collection, it needs to keep track of the object graphs. So this is one part of the memory lost to this internal bookkeeping.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Buffer Pools</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Many libraries and frameworks allocate buffers outside of the heap to improve performance. These buffer pools can be used to share memory between Java code and native code, or map regions of a file into memory.</p></td>
</tr>
</tbody>
</table>


<div class="paragraph">
<p></p>
</div>
<div  id="_memory_consumption_of_a_neo4j_instance" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Memory consumption of a Neo4j instance</h3>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/Neo4j-memoryConsumption.png" alt="Neo4j-memoryConsumption" width="600">
</p>
</div>


<div class="paragraph">
<p>A Neo4j instance consumes memory as follows:</p>
</div>
<table class="tableblock frame-all grid-all stripes-none stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Neo4j Instance Memory Usage</strong></th>
<th class="tableblock halign-left valign-top"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Heap</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">The JVM has a heap that is the runtime data area from which memory for all class instances and arrays are allocated. Heap storage for objects is reclaimed by an automatic storage management system (known as a garbage collector or GC).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Off-heap</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Off-heap refers to objects that are managed by EHCache, but stored outside the heap (and also not subject to GC). As the off-heap store continues to be managed in memory, it is slightly slower than the on-heap store, but still faster than the disk store.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">Page cache</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">The page cache lives off-heap and is used to cache the Neo4j data (and native indexes). The caching of graph data and indexes into memory will help avoid costly disk access and result in optimal performance.</p></td>
</tr>
</tbody>
</table>


<div class="paragraph">
<p></p>
</div>


<div class="paragraph">
<p>Heap allocation is where the runtime data resides including query execution, graph management, and transaction state.</p>
</div>
<div  id="_initial_memory_settings_for_a_database" class="sect3 "  >
<h4>Initial memory settings for a database</h4>


<div class="paragraph">
<p>The amount of memory the Neo4j instance will need may change over time and will depend on the growth of the database, as well as the number and types of queries against the database.</p>
</div>


<div class="paragraph">
<p>Initially, you can obtain a recommendation for property settings related to memory from information in the database using the <code>memrec</code> command of <code>neo4j-admin</code>:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/Neo4j-memrec.png" alt="Neo4j-memrec" width="1000">
</p>
</div>


<div class="paragraph">
<p>This tool provides recommended memory settings based upon information in your database and also information about available memory on your system.</p>
</div>
</div>
</div>
<div  id="_monitoring_memory_consumption" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Monitoring memory consumption</h3>


<div class="paragraph">
<p>If you suspect that there is a memory issue with your Neo4j instance, you should temporarily turn on GC logging in the Neo4j configuration: <code>dbms.logs.gc.enabled=true</code>.  In addition, records will be written to <strong>debug.log</strong> if an out of memory event occurs in the Neo4j instance. When trying to resolve out of memory issues with your application, you should work with Neo4j Technical Support to determine the cause and solution for the problem.</p>
</div>
</div>
<div  id="_using_jcmd_to_obtain_summary_information" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Using jcmd to obtain summary information</h3>


<div class="paragraph">
<p>One way that you can monitor memory usage for a running Neo4j instance is with the <code>jcmd</code> utility which is described in this <a href="https://support.neo4j.com/hc/en-us/articles/360014270873-Understanding-memory-consumption">Neo4j KB article</a>. To monitor memory usage with this utility, you must set <code>dbms.jvm.additional=-XX:NativeMemoryTracking=detail</code> in your Neo4j configuration.</p>
</div>


<div class="paragraph">
<p>Here is an example of a <code>jcmd</code> execution to get summary information about memory usage on the system:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/jcmd.png" alt="jcmd" width="1000">
</p>
</div>
</div>
<div  id="_using_jcmd_in_practice" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Using jcmd in practice</h3>


<div class="paragraph">
<p>If you suspect that certain parts of the application or a transaction is consuming too much memory, you can run <code>jcmd</code> to get a baseline, and then run it again to compare the differences in memory consumption as follows:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>jcmd &lt;PID for Neo4j instance&gt; VM.native_memory baseline
// wait for some time during transaction
jcmd &lt;PID for Neo4j instance&gt; VM.native_memory summary.diff</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title label"></div>
</td>
<td class="content">
In order to use <code>jcmd</code> for a Neo4j instance, you must ensure that the instance is started with the <code>dbms.jvm.additional</code> property set and you must run it as the user <em>neo4j</em>.  <strong>Hint</strong>: <code>sudo su - neo4j</code>.
</td>
</tr>
</table>
</div>


<div class="paragraph">
<p>Refer to the <a href="https://neo4j.com/docs/operations-manual/3.5/performance/">Neo4j Operations Manual</a> for guidance about configuring memory, indexes, etc. for the Neo4j instance. In a production environment, you should work with Neo4j Technical Support to ensure that you are monitoring memory usage and have the appropriate settings. The <em>Performance</em> section of the documentation has guidelines that you should consider when configuring your Neo4j instance that are beyond the scope of this training.</p>
</div>
</div>
<div  id="_exercise_5_monitoring_a_memory_issue" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise #5: Monitoring a memory issue</strong></h3>


<div class="paragraph">
<p>In this Exercise, you will execute a query that exhausts memory, then you will configure memory settings for the Neo4j instance and execute the query again.</p>
</div>


<div class="paragraph">
<p><strong>Before you begin:</strong></p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Make sure that you have exited out of any <code>cypher-shell</code> sessions.
</li>
<li>
Stop the Neo4j instance.
</li>
<li>
Modify the Neo4j configuration to <span class="underline">not</span> time out if a query takes a long time to execute. Simply comment out the settings you set previously in Exercise 2.
</li>
</ol>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Start the Neo4j instance.
</li>
<li>
In <code>cypher-shell</code>, connect to the Neo4j instance as <em>publisher/publisher</em>.
</li>
<li>
Enter the following Cypher statement that will attempt to create 1.3 million <em>Person</em> nodes: <code>FOREACH (i IN RANGE(1,1300000) | CREATE (:Person {name:'Person' + i}));</code>.
</li>
<li>
Wait a few minutes. Eventually, you should receive an error.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex5-OutOfMemory.png" alt="L06-Ex5-OutOfMemory" width="1000">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="5">
<li>
View the the Neo4j log <strong>Hint</strong>: <code>journalctl -e -u neo4j</code> on Debian. It should also have an error logged as well as an error in <strong>debug.log</strong>.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex5-OutOfMemory2.png" alt="L06-Ex5-OutOfMemory2" width="800">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="6">
<li>
Exit out of <code>cypher shell</code>.
</li>
<li>
Stop the Neo4j instance. It may take a few minutes to stop the Neo4j instance as it is cleaning up the transaction log.
</li>
<li>
Execute the command to display the memory requirements for your system specifying the current database which is <strong>movie3.db</strong>.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex5-memrec.png" alt="L06-Ex5-memrec" width="800">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="9">
<li>
If we want to add 1.3 million nodes to this database, we need to adjust the memory requirements to be at a minimum what we see from <code>memrec</code>.  In <strong>neo4j.conf</strong>, modify  <code>dbms.memory.heap.initial_size</code>, <code>dbms.memory.heap.max_size</code> , and <code>dbms.memory.pagecache.size</code> values to reflect what you see from <code>memrec</code>. Make these changes in <strong>neo4j.conf</strong>.
</li>
<li>
Restart the Neo4j instance. This may take a few minutes because the Neo4j instance is cleaning up the transaction log from the previous failed transaction.
</li>
<li>
Log in to <code>cypher-shell</code> as <em>publisher/publisher</em> and try the Cypher statement again that creates 1.3 million nodes.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex5-success.png" alt="L06-Ex5-success" width="800">
</p>
</div>


<div class="paragraph">
<p><strong>Exercise 5: Taking it further</strong>:</p>
</div>


<div class="paragraph">
<p>Perform the above steps while using <code>jcmd</code> to monitor memory consumption.</p>
</div>


<div class="paragraph">
<p>In your production application, you must work with developers and users of the application to understand the size of the transactions. You may need to temporarily set the heap and pagecache sizes higher during a special operation. In most cases, you will set these properties to a value that will be sufficient for all transactions. You must work with Neo4j Technical Support if you run into problems with running out of memory or even with starting the Neo4j instance. If the heap and pagecache sizes are too large, the Neo4j instance will not start.</p>
</div>
</div>
</div>
<div  id="_managing_log_files" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Managing log files</h3>


<div class="paragraph">
<p>As an administrator, you will configure the Neo4j instance to log at the appropriate levels. In most production environments, you will archive log files so that they may be viewed at a later time as part of an auditing process or to troubleshoot a problem. Each type of log file (if configured to use) should have its maximum size defined, as well as the number of log files to keep.</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre># Number of HTTP logs to keep.
#dbms.logs.http.rotation.keep_number=5

# Size of each HTTP log that is kept.
#dbms.logs.http.rotation.size=20m

# Number of query logs to keep.
#dbms.logs.query.rotation.keep_number=5

# Size of each query log that is kept.
#dbms.logs.query.rotation.size=20m

# Number of GC logs to keep.
#dbms.logs.gc.rotation.keep_number=5

# Size of each GC log that is kept.
#dbms.logs.gc.rotation.size=20m

# Size threshold for rotation of the debug log. If set to zero then no rotation will occur. Accepts a binary suffix "k",
# "m" or "g".
#dbms.logs.debug.rotation.size=20m

# Maximum number of history files for the internal log.
#dbms.logs.debug.rotation.keep_number=7

# Threshold for rotation of the security log.
#dbms.logs.security.rotation.size=20m

# Minimum time interval after last rotation of the security log before it may be rotated again.
#dbms.logs.security.rotation.delay=300s

# Maximum number of history files for the security log.
#dbms.logs.security.rotation.keep_number=7</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->
</div>
<div  id="_collecting_metrics_2" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Collecting metrics</h3>


<div class="paragraph">
<p>The Neo4j instance automatically collects metrics in the default location for metrics (for example, on Debian, all metrics are placed in <strong>/var/lib/neo4j/metrics</strong>). If for some reason, you do not want metrics collected, you can disable them by setting <code>metrics.enabled=false</code> in the Neo4j configuration.</p>
</div>


<div class="paragraph">
<p>Metrics are collected in CSV format by default on disk, but Neo4j supports Graphite and Prometheus as protocols to publish those metrics to remote services.  A typical way that customers set this up is to configure Prometheus and then have some external service pull the metrics as needed from Neo4j.  In this way, you don&#8217;t need to set anything up around CSV metrics, but you can readily integrate Neo4j with any other monitoring application that can utilize Prometheus or Graphite. Examples of those include Stackdriver, Grafana, and DataDog. You typically set up these remote services for 24/7 monitoring and alerting.</p>
</div>


<div class="paragraph">
<p>Your options for collecting and viewing metrics are described in the <a href="https://neo4j.com/docs/operations-manual/3.5/monitoring/metrics/">Neo4j Operations Manual</a> which include:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
Publishing to an endpoint using the Graphite protocol.
</li>
<li>
Publishing to an endpoint using the Prometheus protocol.
</li>
<li>
Querying the Neo4j instance using <code>dbms.queryJMX</code>.
</li>
</ul>
</div>


<div class="paragraph">
<p><a href="https://halin.graphapp.io/">Halin</a> has been developed for querying the Neo4j instance. Here are a couple of screen shots when using <em>Halin</em> for viewing metrics:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/Halin1.png" alt="Halin1" width="1100">
</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/Halin2.png" alt="Halin2" width="1100">
</p>
</div>


<div class="paragraph">
<p>In most cases for a production environment, you will set up a remote service for monitoring and alerting, but then you may also execute ad hoc queries with a tool such as <em>Halin</em>.</p>
</div>
<div  id="_using_jmx_queries" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Using JMX queries</h3>


<div class="paragraph">
<p>A Neo4j instance can be monitored with Java Management Extensions (JMX). JMX is a low-level mechanism for monitoring the Neo4j instance. However, a best practice is <span class="underline">not</span> to use it for remote monitoring as it is a security vulnerability. In addition, running a tool such as <code>jconsole</code> that uses JMX can use production system resources which is also not recommended.</p>
</div>


<div class="paragraph">
<p>Neo4j supports the use of JMX in Cypher queries. This is something that is safe to do remotely and does not consume resources locally.</p>
</div>


<div class="paragraph">
<p>For example, here is a rather long Cypher statement that retrieves the same information that you would expect to see when you run the <code>:sysinfo</code> command in Neo4j Browser:</p>
</div>
<div class="listingblock">
<div class="content code-panel" style="width: 800px; height: auto; border: medium 1px;">
<pre>CALL dbms.queryJmx("org.neo4j:instance=kernel#0,name=Store file sizes") YIELD attributes
       WITH  keys(attributes) AS k , attributes
       UNWIND k AS row
       RETURN "StoreSizes" AS type,row,attributes[row]["value"]

UNION ALL

CALL dbms.queryJmx("org.neo4j:instance=kernel#0,name=Page cache") YIELD attributes
       WITH  keys(attributes) AS k , attributes
       UNWIND k AS row
       RETURN "PageCache" AS type,row,attributes[row]["value"]

UNION ALL

CALL dbms.queryJmx("org.neo4j:instance=kernel#0,name=Primitive count") YIELD attributes
       WITH  keys(attributes) AS k , attributes
       UNWIND k AS row
       RETURN "ID Allocations" AS type,row,attributes[row]["value"]

UNION ALL

CALL dbms.queryJmx("org.neo4j:instance=kernel#0,name=Transactions") YIELD attributes
       WITH  keys(attributes) AS k , attributes
       UNWIND k AS row
       RETURN "Transactions" AS type,row,attributes[row]["value"]

UNION ALL

CALL dbms.queryJmx("org.neo4j:instance=kernel#0,name=High Availability") YIELD attributes
       WITH  keys(attributes) AS k , attributes
       UNWIND k AS row
       RETURN "High Availability" AS type,row,attributes[row]["value"]

UNION ALL

CALL dbms.queryJmx("org.neo4j:instance=kernel#0,name=Causal Clustering") YIELD attributes
       WITH  keys(attributes) AS k , attributes
       UNWIND k AS row
       RETURN "Causal Cluster" AS type,row,attributes[row]["value"];</pre>
</div>
</div>
<!--
data-lang=”{language}” class=””
-->


<div class="paragraph">
<p>Here is the result of executing this Cypher statement:</p>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/CypherJMX.png" alt="CyperJMX" width="800">
</p>
</div>
</div>
<div  id="_exercise_6_querying_with_jmx" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3><strong>Exercise #6: Querying with JMX</strong></h3>


<div class="paragraph">
<p>In this Exercise, you will execute a JMX query to view metrics about the Neo4j instance.</p>
</div>


<div class="paragraph">
<p><strong>Before you begin:</strong></p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Make sure you have a started Neo4j instance.
</li>
<li>
Open a terminal window.
</li>
</ol>
</div>


<div class="paragraph">
<p><strong>Exercise steps</strong>:</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic">
<li>
Log in to the Neo4j instance with <code>cypher-shell</code> using the credentials <em>publisher/publisher</em>.
</li>
<li>
Execute the Cypher statement shown above for querying for metrics.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex6-CypherJMX1.png" alt="L06-Ex6-CypherJMX1" width="800">
</p>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="3">
<li>
Execute the Cypher statement for creating 1.3 million nodes: <code>FOREACH (i IN RANGE(1,1300000) | CREATE (:Person {name:'Person' + i}));</code>.
</li>
</ol>
</div>
<div class="olist arabic">
<ol style="margin-left: 2.4rem;" class="arabic" start="4">
<li>
Execute the Cypher statement shown above for querying for metrics.
</li>
</ol>
</div>
<div class="imageblock" style="text-align: center;">
<p class="content">
<img src="https://graphacademy.neo4j.com/img/neo4j-administration/L06-Ex6-CypherJMX2.png" alt="L06-Ex6-CypherJMX2" width="800">
</p>
</div>
</div>
</div>
<div  id="module-6" class="sect1 quiz columns medium-12" style='padding-left: 0;' >
<h3>Check your understanding</h3>
<div  id="_question_1" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Question 1</h3>


<div class="paragraph">
<p>What Cypher statements can you run to determine if a query is taking too long to execute?</p>
</div>


<div class="paragraph">
<p>Select the correct answers.</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">CALL dbms.getStats();</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">CALL dbms.listStats();</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">CALL dbms.listTransactions();</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">CALL dbms.listQueries();</span>
</li>
</ul>
</div>
</div>
<div  id="_question_2" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Question 2</h3>


<div class="paragraph">
<p>What tool can you use to determine how much virtual memory you should configure for the Neo4j instance?</p>
</div>


<div class="paragraph">
<p>Select the correct answer.</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">jcmd</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">vmstat</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">neo4j-admin memrec</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="false-answer">neo4j-admin analyze</span>
</li>
</ul>
</div>
</div>
<div  id="_question_3" class="sect2 columns medium-12" style='padding-left: 0;' >
<h3>Question 3</h3>


<div class="paragraph">
<p>How can Neo4j metrics be used?</p>
</div>


<div class="paragraph">
<p>Select the correct answers.</p>
</div>
<div class="ulist checklist">
<ul class="checklist">
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">Placed in CSV files for tools to use.</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">Published to an endpoint using the Graphite protocol.</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">Published to an endpoint using the Prometheus protocol.</span>
</li>
<li>
<input type="checkbox" data-item-complete="0"> <span class="required-answer">Queried using dbms.queryJMX().</span>
</li>
</ul>
</div>
</div>
</div>
<div  id="_summary" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Summary</h3>


<div class="paragraph">
<p>You should now be able to:</p>
</div>
<div class="ulist square">
<ul class="square">
<li>
Describe the categories of monitoring and measurement you can perform with Neo4j.
</li>
<li>
Monitor:
<div class="ulist">
<ul>
<li>
queries
</li>
<li>
transactions
</li>
<li>
connections
</li>
<li>
memory usage
</li>
</ul>
</div>
</li>
<li>
Manage log files.
</li>
<li>
Manage the collection of Neo4j metrics.
</li>
<li>
Use JMX queries.
</li>
</ul>
</div>
</div>
<div  id="_grade_quiz_and_continue" class="sect1 columns medium-12" style='padding-left: 0;' >
<h3>Grade Quiz and Continue</h3>
<a class="next-section medium button" href="../part-7/">Continue to Module 7</a>
<script src="https://cdn.auth0.com/js/lock/11.23.0/lock.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script>
<script src="https://js.maxmind.com/js/apis/geoip2/v2.1/geoip2.js" type="text/javascript"></script>

<script>
var auth0Options = {
	configurationBaseUrl: 'https://cdn.auth0.com',
	allowedConnections: ['google-oauth2', 'linkedin', 'twitter', 'Username-Password-Authentication'],
	additionalSignUpFields: [
		{
			name: 'first_name',
			placeholder: 'First Name'
		},
		{
			name: 'last_name',
			placeholder: 'Last Name'
		}
	],
	closable: false,
	languageDictionary: {
		signUpTerms: "I agree to the <a href='https://neo4j.com/terms/online-trial-agreement/' style='text-decoration: underline' target='_blank'>terms of service</a> of Neo4j."
	},
	mustAcceptTerms: true,
	auth: {
		redirect: true,
		redirectUrl: 'https://neo4j.com/accounts/login',
		responseType: 'token id_token',
		audience: 'neo4j://accountinfo/',
		params: {
			scope: 'read:account-info write:account-info openid email profile user_metadata'
		}
	}
}

const classStates = {
	loggedIn: 'graph-academy-for-logged-in',
	notLoggedIn: 'graph-academy-for-not-logged-in'
}

class GraphAcademyLogin {
	constructor(options = {}) {
		console.log('constructor called');
		if (!Auth0Lock || typeof Auth0Lock !== 'function') return;
		console.log(options);
		this.lock = new Auth0Lock('DxhmiF8TCeznI7Xoi08UyYScLGZnk4ke', 'login.neo4j.com', auth0Options);
		this.options = options;
		this.checkSession(options.callback);
	}

	checkSession(cb) {
		this.lock.checkSession({}, async (err, result) => {
			console.log(result);
			if (result) {
				this.isLoggedIn = true;
				this.authResult = result;
				if (this.callback && typeof this.callback === 'function') this.callback()
			} else {
				this.isLoggedIn = false;
			}
			if (err && this.options.loginRedirectUrl) {
				this.redirectToLogin();
			}
			this.handleHtmlOnState(result ? 'loggedIn' : 'notLoggedIn');
			if (cb && typeof cb === 'function') cb(err, result);
		})
	}

	handleHtmlOnState(state = null) {
		const loggedInElements = document.getElementsByClassName(classStates['loggedIn']) || [];
		const notLoggedInElements = document.getElementsByClassName(classStates['notLoggedIn']) || [];
		if (state === 'loggedIn') {
			for (let item of loggedInElements) {
				item.style.display = 'inherit';
			}
			for (let item of notLoggedInElements) {
				item.style.display = 'none';
			}
		} else if (state === 'notLoggedIn') {
			for (let item of loggedInElements) {
				item.style.display = 'none';
			}
			for (let item of notLoggedInElements) {
				item.style.display = 'inherit';
			}
		}
	}

	logout() {
		const logoutOptions = {};
		if (this.options.redirectOnLogout) logoutOptions.redirectTo = this.options.redirectOnLogout;
		this.lock.logout(logoutOptions);
		this.handleHtmlOnState('notLoggedIn');
	}

	redirectToLogin() {
		return window.location.href = this.options.loginRedirectUrl;
	}
}
 </script>

<script>
  const login = new GraphAcademyLogin();
</script>

 <link rel='stylesheet' id='neo-codemirror-css'
    href="https://neo4j.com/wp-content/themes/neo4jweb/assets/css/codemirror-neo.css?ver=4.5" type='text/css'
    media='screen'/>

 <script type='text/javascript'>
  $('.admonitionblock.note').find('.icon').html('NOTE');
  $('.admonitionblock.warning').find('.icon').html('WARNING');
  $('.admonitionblock.information').find('.icon').html('INFO');

  var isBlock = /^(p|li|div|h\\d|pre|blockquote|td)$/;

  function textContent(node, out) {
    if (node.nodeType == 3) return out.push(node.nodeValue);
    for (var ch = node.firstChild; ch; ch = ch.nextSibling) {
      textContent(ch, out);
      if (isBlock.test(node.nodeType)) out.push("\n");
    }
  }

  CodeMirror.colorize = function(collection, defaultMode) {
    if (!collection) collection = document.body.getElementsByTagName("pre");

    for (var i = 0; i < collection.length; ++i) {
      var syntax = false;
      var node = collection[i];
      var mode = node.getAttribute("data-lang") || defaultMode;
      if (mode == "cypher-syntax") {
        syntax = true;
        mode = "cypher";
      }
      if (!mode) continue;

      var text = [];
      textContent(node, text);
      node.innerHTML = "";
      CodeMirror.runMode(text.join(""), mode, node);

      node.className += " cm-s-default";
      if (syntax) {
        node.className += " cypher-syntax";
      }
    }
  };

  $( document ).ready(function() {
    if (CodeMirror.colorize) {
      CodeMirror.colorize(document.body.getElementsByTagName("pre"), 'cypher');
    }
  });
 </script>


<script>
  window.intercomSettings = {
    app_id: "dt0ig5ab",
    hide_default_launcher: true
  };
</script>
<script>(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',intercomSettings);}else{var d=document;var i=function(){i.c(arguments)};i.q=[];i.c=function(args){i.q.push(args)};w.Intercom=i;function l(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/dt0ig5ab';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);}if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})()</script>

<!-- JWT decoder: ONLY USE TO SEE UN-VERIFIED VALUES -->
<script src="http://s3.amazonaws.com/dev.assets.neo4j.com/wp-content/js/jwt-decode.min.js"></script>


<script>
const SITE_URL = window.location;


$( document ).ready(function() {
       const login = new GraphAcademyLogin({loginRedirectUrl: "https://neo4j.com/graphacademy/online-training/neo4j-administration/"});

        login.checkSession((err, result) => {
            if (result) {
               getQuizStatus();

              /*
                var userInfoIntercom = Cookies.getJSON("com.neo4j.accounts.userInfo");
                if (userInfoIntercom) {
                  try {
                    window.Intercom("update", {
                      app_id: "dt0ig5ab",
                      name: userInfoIntercom.name,
                      email: userInfoIntercom.email,
                      user_id: userInfoIntercom.sub,
                      hide_default_launcher: true
                    });;
                  } catch (err) {
                    console.error(err);
                  }
                }
                Intercom('trackEvent','training-neo4j-admin-view');
                */
            }
        })

});
</script>
<script>
$( document ).ready(function() {
  Intercom('trackEvent','training-admin-view-part6');
});
</script>
</div>
</div>
<div id="sidebar-wrapper">
        
        <div id="toc" class="toc2">
        <div id="toctitle">Module: Monitoring  Neo4j</div>
        <ul class="sectlevel1">
<li><a href="#_about_this_module">About this module</a></li>
<li><a href="#_monitoring_in_neo4j">Monitoring in Neo4j</a>
<ul class="sectlevel2">
<li><a href="#_monitoring_log_files">Monitoring log files</a></li>
<li><a href="#_collecting_metrics">Collecting metrics</a></li>
</ul>
</li>
<li><a href="#_monitoring_queries">Monitoring queries</a>
<ul class="sectlevel2">
<li><a href="#_configuring_query_logging">Configuring query logging</a></li>
<li><a href="#_long_running_queries">Long-running queries</a></li>
<li><a href="#_viewing_currently_running_queries_neo4j_browser">Viewing currently running queries (Neo4j Browser)</a></li>
<li><a href="#_viewing_currently_running_queries_cypher_shell">Viewing currently running queries (cypher-shell)</a></li>
<li><a href="#_killing_a_long_running_query">Killing a long-running query</a>
<ul class="sectlevel3">
<li><a href="#_killing_a_long_running_query_cypher_shell">Killing a long-running query (cypher-shell)</a></li>
</ul>
</li>
<li><a href="#_exercise_1_monitoring_queries"><strong>Exercise #1: Monitoring queries</strong></a></li>
<li><a href="#_automating_monitoring_of_queries">Automating monitoring of queries</a></li>
</ul>
</li>
<li><a href="#_monitoring_transactions">Monitoring transactions</a>
<ul class="sectlevel2">
<li><a href="#_example_configuring_transaction_guard">Example: Configuring transaction guard</a></li>
<li><a href="#_exercise_2_monitoring_transactions"><strong>Exercise #2: Monitoring transactions</strong></a></li>
<li><a href="#_monitoring_locks">Monitoring locks</a></li>
</ul>
</li>
<li><a href="#_monitoring_connections">Monitoring connections</a>
<ul class="sectlevel2">
<li><a href="#_monitoring_and_terminating_connections">Monitoring and terminating connections</a></li>
<li><a href="#_exercise_3_monitoring_connections"><strong>Exercise #3: Monitoring connections</strong></a></li>
<li><a href="#_logging_http_requests">Logging HTTP requests</a></li>
<li><a href="#_exercise_4_monitoring_http_requests"><strong>Exercise #4: Monitoring HTTP requests</strong></a></li>
</ul>
</li>
<li><a href="#_monitoring_memory_usage">Monitoring memory usage</a>
<ul class="sectlevel2">
<li><a href="#_memory_consumption_of_a_neo4j_instance">Memory consumption of a Neo4j instance</a>
<ul class="sectlevel3">
<li><a href="#_initial_memory_settings_for_a_database">Initial memory settings for a database</a></li>
</ul>
</li>
<li><a href="#_monitoring_memory_consumption">Monitoring memory consumption</a></li>
<li><a href="#_using_jcmd_to_obtain_summary_information">Using jcmd to obtain summary information</a></li>
<li><a href="#_using_jcmd_in_practice">Using jcmd in practice</a></li>
<li><a href="#_exercise_5_monitoring_a_memory_issue"><strong>Exercise #5: Monitoring a memory issue</strong></a></li>
</ul>
</li>
<li><a href="#_managing_log_files">Managing log files</a></li>
<li><a href="#_collecting_metrics_2">Collecting metrics</a>
<ul class="sectlevel2">
<li><a href="#_using_jmx_queries">Using JMX queries</a></li>
<li><a href="#_exercise_6_querying_with_jmx"><strong>Exercise #6: Querying with JMX</strong></a></li>
</ul>
</li>
<li><a href="#module-6">Check your understanding</a>
<ul class="sectlevel2">
<li><a href="#_question_1">Question 1</a></li>
<li><a href="#_question_2">Question 2</a></li>
<li><a href="#_question_3">Question 3</a></li>
</ul>
</li>
<li><a href="#_summary">Summary</a></li>
<li><a href="#_grade_quiz_and_continue">Grade Quiz and Continue</a></li>
</ul>
        </div>
<div id="progress" style="position:absolute; bottom:100;"></div>
</div>